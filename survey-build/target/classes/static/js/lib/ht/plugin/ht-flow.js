!function(t){"use strict";var v="ht",X=t[v],Y=X.Default,c=Math,j=c.PI,U=2*j,o=c.sin,J=c.cos,P=c.atan2,A=c.sqrt,e=c.max,g=c.floor,h=(c.round,c.ceil),C=c.abs,n=X.Shape,a=X.Edge,S=X.List,Q=X.Style,u=X.graph,V=Y.getInternal(),k=V.ui(),l=null,R="__segmentLengths",q="__lineTotalLength",b="__linePoints",w="__distance0",x="flow.count",M="flow.step",s="flow.element.max",i="flow.element.count",O="flow.element.min",$="flow.element.space",G="flow.element.autorotate",N="flow.element.background",K="flow.element.shadow.max",I="flow.element.shadow.min",_="flow.element.shadow.begincolor",F="flow.element.shadow.endcolor",W="flow.element.shadow.visible",z="flow.element.image",Z="flow",L="prototype",T=u.GraphView[L],B=X.Data[L],m=k.DataUI[L],y=k.ShapeUI[L],E=k.EdgeUI[L],d=X.DataModel[L],D=y._80o,f=E._80o,p=d.prepareRemove,H=E._79o,r=y._79o,bm=T.setDataModel,Ak=function(S){return document.createElement(S)};T.calculatePointLength=function(Q,Z,i){var j=this,f=j.getDataUI(Q);i==l&&(i=.1);var $=_l(f),F=[];if($){for(var K=$.length,T=0;K>T;T++){var S=$[T];S._as&&(S=S._as);for(var R=S[0],o=1;o<S.length;o++)F.push([R,S[o]]),R=S[o]}for(var s=[],T=0;T<F.length;T++){var x=Mi(F[T][0],F[T][1],Z);s.push(x)}var M=s.slice(0);M.sort(function(f,y){return f.z>y.z?1:f.z<y.z?-1:0});var y=M[0];if(y.z<i){for(var w=s.indexOf(y),I=0,T=0;w>=T;T++)I+=w>T?Y.getDistance(F[T][0],F[T][1]):Y.getDistance(F[T][0],y);return I}}},Y.calculatePointLength=function(S,h,q,B){B==l&&(B=.1);var I=_l(l,S,h),h=[];if(I){for(var H=I.length,t=0;H>t;t++){var e=I[t];e._as&&(e=e._as);for(var a=e[0],x=1;x<e.length;x++)h.push([a,e[x]]),a=e[x]}for(var G=[],t=0;t<h.length;t++){var R=Mi(h[t][0],h[t][1],q);G.push(R)}var K=G.slice(0);K.sort(function(t,G){return t.z>G.z?1:t.z<G.z?-1:0});var N=K[0];if(N.z<B){for(var $=G.indexOf(N),A=0,t=0;$>=t;t++)A+=$>t?Y.getDistance(h[t][0],h[t][1]):Y.getDistance(h[t][0],N);return A}}},T.calculateClosestPoint=function(g,e){var i=this,Y=i.getDataUI(g),E=_l(Y),X=[];if(E){for(var c=E.length,v=0;c>v;v++){var N=E[v];N._as&&(N=N._as);for(var p=N[0],Z=1;Z<N.length;Z++)X.push([p,N[Z]]),p=N[Z]}for(var b=[],v=0;v<X.length;v++){var d=Mi(X[v][0],X[v][1],e);b.push(d)}return b.sort(function(S,c){return S.z>c.z?1:S.z<c.z?-1:0}),b[0]}},Y.calculateClosestPoint=function(J,S,e){var D=_l(l,J,S),S=[];if(D){for(var i=D.length,k=0;i>k;k++){var H=D[k];H._as&&(H=H._as);for(var B=H[0],g=1;g<H.length;g++)S.push([B,H[g]]),B=H[g]}for(var _=[],k=0;k<S.length;k++){var C=Mi(S[k][0],S[k][1],e);_.push(C)}return _.sort(function(f,n){return f.z>n.z?1:f.z<n.z?-1:0}),_[0]}},T.getPercentAngle=function(I,_){var $=this,X=$.getDataUI(I),f=I.getRotation?I.getRotation():0,B=_l(X);if(B)if(0===_){var J=B[0][0],e=B[0][1];f+=P(e.y-J.y,e.x-J.x)}else if(100===_){B=B[B.length-1];var J=B[B.length-2],e=B[B.length-1];f+=P(e.y-J.y,e.x-J.x)}else{for(var G=0,L=[],C=B.length,x=0;C>x;x++){var R=B[x],T=fn(R);G+=T,L.push(T)}for(var E=G*_/100,H=kc(E,L),z=0,l=0;H>l;l++)z+=L[l];E-=z;for(var t=rn(B[H],E),O=B[H],c=0,W=0,m=0;m<O.length-1;m++){var D=O[m],Q=O[m+1],p=Q.x-D.x,k=Q.y-D.y,F=A(p*p+k*k);if(c+=F,c>E){W=m;break}}var n=O[W];f+=P(t.y-n.y,t.x-n.x)}return f},Y.getPercentAngle=function(v,c,x){var V=0,J=_l(l,v,c);if(J)if(0===x){var E=J[0][0],Y=J[0][1];V+=P(Y.y-E.y,Y.x-E.x)}else if(100===x){J=J[J.length-1];var E=J[J.length-2],Y=J[J.length-1];V+=P(Y.y-E.y,Y.x-E.x)}else{for(var j=0,G=[],b=J.length,R=0;b>R;R++){var h=J[R],_=fn(h);j+=_,G.push(_)}for(var y=j*x/100,Z=kc(y,G),O=0,$=0;Z>$;$++)O+=G[$];y-=O;for(var a=rn(J[Z],y),g=J[Z],W=0,i=0,t=0;t<g.length-1;t++){var r=g[t],f=g[t+1],N=f.x-r.x,F=f.y-r.y,d=A(N*N+F*F);if(W+=d,W>y){i=t;break}}var K=g[i];V+=P(a.y-K.y,a.x-K.x)}return V},T.calculateLength=function(O){var K=this,f=K.getDataUI(O),X=_l(f),l=0;if(X)if(Array.isArray(X[0]))for(var T=X.length,H=0;T>H;H++){var c=X[H],L=fn(c);l+=L}else l=fn(X);return l},Y.calculateLength=function(m,H){var m=_l(l,m,H),b=0;if(m)if(Array.isArray(m[0]))for(var t=m.length,Y=0;t>Y;Y++){var j=m[Y],n=fn(j);b+=n}else b=fn(m);return b};var Mi=Y.calculateClosestPointOnLine=function(S,D,K){var W=S.x,c=S.y,j=D.x,Q=D.y,s=K.x,J=K.y,u={},g=j-W,Z=Q-c,w=Math.sqrt(g*g+Z*Z),e=g/w,V=Z/w,n=(-W+s)*e+(-c+J)*V;return u.x=W+n*e,u.y=c+n*V,is(u,S,D)||(u.x=Math.abs(u.x-S.x)<Math.abs(u.x-D.x)?S.x:D.x,u.y=Math.abs(u.y-S.y)<Math.abs(u.y-D.y)?S.y:D.y),g=s-u.x,Z=J-u.y,u.z=Math.sqrt(g*g+Z*Z),u},is=function(b,N,a){return b.x>=Math.min(N.x,a.x)&&b.x<=Math.max(N.x,a.x)&&b.y>=Math.min(N.y,a.y)&&b.y<=Math.max(N.y,a.y)},fn=function(t){for(var f=0,x=t.length-1,S=0;x>S;S++){var z=t[S],b=t[S+1],E=b.x-z.x,r=b.y-z.y,$=A(E*E+r*r);f+=$}return f},rn=function(G,R){for(var S=0,B=0,U=0,b=G.length-1,I=0;b>I;I++){var x=G[I],v=G[I+1],p=v.x-x.x,D=v.y-x.y;if(U=A(p*p+D*D),S+=U,S>R){S-=U,B=I;break}}var O=G[B],u=G[B+1],r=P(u.y-O.y,u.x-O.x),d=R-S,D=o(r)*d,p=J(r)*d;return{x:O.x+p,y:O.y+D}},Pr=function(K,s,i,r){var h=J(r),e=o(r),j=h*s-e*i,G=e*s+h*i;return K?{x:K.x+j,y:K.y+G}:{x:j,y:G}},fc=function(f,D){f[R]=f[q]=f[b]=D[w]=l},tr=function(A,v,i,O,M,G){var g,S,N,m,P,e,l,q,k,E,d,x=[];if(C(O)>U&&(O=U),P=h(C(O)/(j/4)),g=O/P,S=-g,N=-i,P>0){e=A+J(i)*M,l=v+o(-i)*G,x.push({x:e,y:l});for(var a=0;P>a;a++)N+=S,m=N-S/2,q=A+J(N)*M,k=v+o(N)*G,E=A+J(m)*(M/J(S/2)),d=v+o(m)*(G/J(S/2)),x.push({x:E,y:d}),x.push({x:q,y:k})}return x},_l=function(Y,$,J){if($==l){var w=Y._data;if(w instanceof n){if($=w.getPoints(),J=w.getSegments(),(!J||0===J.size())&&$){J=new X.List([1]);for(var T=1;T<$.size();T++)J.add(2)}}else if(w instanceof a){var k=Y._78o;if(k){var Z=k.type,i=k.points,Q=k.segments,z=k._4O;if(!Z||i){var b=k.sourcePoint,M=b.x,G=b.y,N=k.targetPoint,r=N.x,t=N.y;if(Z)Q?($=new S({x:M,y:G}),$.addAll(i),$.add({x:r,y:t}),J=new S(Q._as)):($=new S({x:M,y:G}),J=new S([1]),i.each(function(D){$.add(D),J.add(2)}),$.add({x:r,y:t}),J.add(2));else if(k.looped){$=new S(tr(M,G,0,U,k.radius,k.radius)),J=new S([1]);for(var T=0;T<($.size()-1)/2;T++)J.add(3)}else $=new S,k.center?($.add({x:k.c1.x,y:k.c1.y}),$.add({x:M,y:G}),$.add({x:r,y:t}),$.add({x:k.c2.x,y:k.c2.y}),J=new S([1,2,2,2])):($.add({x:M,y:G}),$.add({x:r,y:t}),J=new S([1,2]))}else if(z)if($=new S(z.points._as),z.segments)J=new S(z.segments._as);else{J=new S([1]);for(var T=1;T<z.points.size();T++)J.add(2)}}}}if($){if(Array.isArray($)&&($=new S($)),"number"==typeof $.get(0)){for(var D=new X.List,T=0;T<$.size();T+=2)D.add({x:$.get(T),y:$.get(T+1)});$=D}if(!J){J=[];for(var T=0;T<$.size();T++)0===T?J.push(1):J.push(2)}Array.isArray(J)&&(J=new S(J));for(var P=V.toPointsArray($._as,J._as,50),m=P.length,j=[],T=0;m>T;T++){var h=P[T];h.length>1&&j.push(h)}return j}},yc=function(d){var g=d._data,A=_l(d);if(A){g.s("flow.reverse")&&(A.reverse(),A.forEach(function(b){b.reverse()}));for(var I=0,F=[],s=A.length,G=0;s>G;G++){var h=A[G],y=fn(h);I+=y,F.push(y)}if(g[R]=F,g[q]=I,g[b]=A,g instanceof a){var j=Y.unionPoint(A),H=j.x+j.width/2,O=j.y+j.height/2;g.$10e={x:H,y:O}}br(d,!0)}},br=(Y.getPercentPositionOnPoints=function($,m,o){if($){var x=_l(l,$,m);if(x){var v;if(0===o)v=x[0][0];else if(100===o)x=x[x.length-1],v=x[x.length-1];else{for(var I=0,r=[],z=x.length,P=0;z>P;P++){var h=x[P],E=fn(h);I+=E,r.push(E)}for(var q=I*o/100,K=kc(q,r),R=0,k=0;K>k;k++)R+=r[k];q-=R,v=rn(x[K],q)}return v}}},T.getPercentPosition=function(x,b){var e=this,q=e.getDataUI(x),r=_l(q);if(r){var E;if(0===b)E=r[0][0];else if(100===b)r=r[r.length-1],E=r[r.length-1];else{for(var C=0,T=[],V=r.length,W=0;V>W;W++){var P=r[W],K=fn(P);C+=K,T.push(K)}for(var B=C*b/100,i=kc(B,T),w=0,j=0;i>j;j++)w+=T[j];B-=w,E=rn(r[i],B)}return E}},function(A,Z){var d=A._data,Y=d[q],L=d.s(x),W=d.s(M),K=0,P=d[R],p=d.s(s),e=d.s(O),S=d.s(i),t=(p-e)/(S-1),G=[];if(P){if(1===S)G.push(p);else if(2===S)G.push(p),G.push(e);else{if(!(S>2))return;G.push(p);for(var U=S-2;U>0;U--)G.push(e+t*U);G.push(e)}var H=0,B=0;G.forEach(function(p){S-1>H&&(B+=d.getFlowElementSpace(p)),H++}),B+=(p+e)/2,K=(Y-L*B+B)/L;var C=A[w];for(null==C&&(C=0),Z||(C+=W);C>Y+B;){var $=A._overCount;$?$++:$=1,$>=L&&($=null),A._overCount=$,d.s("flow.autoreverse")?$?C-=K+B:(C=0,d.s("flow.reverse",!d.s("flow.reverse"))):C-=K+B}A[w]=C}}),hr=function(X){var J=X.data,a=this.dm();if(J&&"add"===X.kind){var f=a.$3e;f&&J.s(Z)&&f.indexOf(J)<0&&f.push(J)}"clear"===X.kind&&(a.$3e=[])},gb=function(G){var e=G.property,V=G.data,C=G.newValue,D=this.dm().$3e;if(D&&"s:flow"===e)if(C)D.indexOf(V)<0&&D.push(V);else for(var K=D.length,W=0;K>W;W++)if(D[W]===V){D.splice(W,1);break}},kc=kc=function(u,L){for(var W=0,G=L.length,t=0;G>t;t++){var f=L[t];if(W+=f,W>u)return t}return Math.min(t,G-1)},Sb=function(V){var g=this,M=g._data,B=M[q],H=M[R],e=M[b],S=M.s(x),n=0,Q=g[w],k=M.s(s),t=M.s(O),r=M.s(i),U=M.s(I),L=M.s(K),v=M.s(G),a=(L-U)/(r-1),D=(k-t)/(r-1),T=M.getRotation?M.getRotation():0,f=M.getPosition?M.p():M.$10e,z=[],J=[];if(Q!=l){if(1===r)z.push(k);else if(2===r)z.push(k),z.push(t);else{if(!(r>2))return;z.push(k);for(var u=r-2;u>0;u--)z.push(t+D*u);z.push(t)}if(1===r)J.push(L);else if(2===r)J.push(L),J.push(U);else{if(!(r>2))return;J.push(L);for(var u=r-2;u>0;u--)J.push(U+a*u);J.push(U)}var h=0,j=0;z.forEach(function(J){r-1>h&&(j+=M.getFlowElementSpace(J)),h++}),j+=(k+t)/2,n=(B-S*j+j)/S,V.save();for(var u=0;S>u;u++){var C=Q,c=0,E=g._overCount,y=0;M.s("flow.autoreverse")&&E&&E>S-(u+1)||(C-=u*(n+j),h=0,z.forEach(function(N){var R=C-c;if(R>=0&&B>R){var n=!0,X=kc(R,H);y=0;for(var D=0;X>D;D++)y+=H[D];if(R-=y,n){var E=rn(e[X],R),U=T;if(v){for(var q=e[X],K=0,Q=0,x=0;x<q.length-1;x++){var k=q[x],S=q[x+1],d=S.x-k.x,Y=S.y-k.y,F=A(d*d+Y*Y);if(K+=F,K>R){Q=x;break}}var G=q[Q];U+=P(E.y-G.y,E.x-G.x)}T&&(E=Pr(f,E.x-f.x,E.y-f.y,T)),g.$5e(V,E,N,J[h],U)}}c+=M.getFlowElementSpace(z[h]),h++}))}V.restore()}},wg=function(){var A=this,G=A._data,R=G.s(s),w=!1,g=l;if(A._6I||(w=!0),g=G instanceof a?H.call(A):r.call(A),G.s(Z)&&w){var $=G.s(K),t=G.s(W);t&&$>R&&(R=$),R>0&&Y.grow(g,h(R/2)),yc(A)}return!G.s(Z)&&w&&fc(G,A),g};B.getFlowElementSpace=function(){return this.s($)},y._79o=wg,E._79o=wg,Q[s]==l&&(Q[s]=7),Q[O]==l&&(Q[O]=0),Q[x]==l&&(Q[x]=1),Q[M]==l&&(Q[M]=3),Q[i]==l&&(Q[i]=10),Q[$]==l&&(Q[$]=3.5),Q[G]==l&&(Q[G]=!1),Q[N]==l&&(Q[N]="rgba(255, 255, 114, 0.4)"),Q[_]==l&&(Q[_]="rgba(255, 255, 0, 0.3)"),Q[F]==l&&(Q[F]="rgba(255, 255, 0, 0)"),Q[W]==l&&(Q[W]=1),Q[K]==l&&(Q[K]=22),Q[I]==l&&(Q[I]=4),d.prepareRemove=function(o){p.call(this,o);var Z=o._dataModel,K=Z.$3e;if(K)for(var j=K.length,e=0;j>e;e++)if(K[e]===o){K.splice(e,1);break}},T.setDataModel=function(i){var $=this,d=$._dataModel;if(d!==i){d&&(d.umm(hr,$),d.umd(gb,$),d.$3e=[]),i.mm(hr,$),i.md(gb,$);var K=i.$3e=[];i.each(function(M){M.s(Z)&&K.indexOf(M)<0&&K.push(M)}),bm.call($,i)}},T.setFlowInterval=function(E){var D=this,e=D.$11e;D.$11e=E,D.fp("flowInterval",e,E),D.$7e!=l&&(clearInterval(D.$7e),delete D.$7e,D.enableFlow(E))},T.getFlowInterval=function(){return this.$11e},T.$9e=function(){var p,P,E,K=this,i=K.tx(),n=K.ty(),o=K.getZoom(),t=K.getWidth(),w=K.getHeight(),L={x:-i/o,y:-n/o,width:t/o,height:w/o},c=K.dm().$3e,M=K._56I,$=new S;if(c.forEach(function(U){M[U.getId()]&&(p=K.getDataUI(U),p&&(E=p._79o(),E&&$.add(E)))}),0!==$.size()&&($.each(function(F){Y.intersectsRect(L,F)&&(P=Y.unionRect(P,F))}),P&&(P&&(Y.grow(P,e(1,1/o)),P.x=g(P.x*o)/o,P.y=g(P.y*o)/o,P.width=h(P.width*o)/o,P.height=h(P.height*o)/o,P=Y.intersection(L,P)),P))){var Z=K._canvas.getContext("2d");Z.save(),Z.lineCap=Y.lineCap,Z.lineJoin=Y.lineJoin,V.translateAndScale(Z,i,n,o),Z.beginPath(),Z.rect(P.x,P.y,P.width,P.height),Z.clip(),Z.clearRect(P.x,P.y,P.width,P.height),K.$6e(Z,P),Z.restore()}},T.$6e=function(R,Q){var H,K,N=this;N._93db(R),N.each(function(L){N._56I[L._id]&&(H=N.getDataUI(L),H&&(K=H._79o(),(!Q||Y.intersectsRect(Q,K))&&H._42(R)))}),N._92db(R)},T.enableFlow=function(H){var Z=this,g=Z.dm(),J=g.$3e;Z.$7e==l&&(J.forEach(function(B){var $=Z.getDataUI(B);yc($)}),Z.$7e=setInterval(function(){g.$3e.forEach(function(g){br(Z.getDataUI(g))}),Z.$9e()},H||Z.$11e||50))},T.disableFlow=function(){var m=this;clearInterval(m.$7e),delete m.$7e;var l=m.dm().$3e;l&&m.$9e()},m.$5e=function(Z,r,X,c,h){var v=this,b=v._data,w=v.gv,j=b.s(N),u=b.s(_),C=b.s(F),A=b.s(W),y=w.$8e,B=b.s(z);if(y==l&&(y=w.$8e={}),Z.beginPath(),B!=l){var i=Y.getImage(B),P=X/2;Z.translate(r.x,r.y),Z.rotate(h),Z.translate(-r.x,-r.y),Y.drawImage(Z,i,r.x-P,r.y-P,X,X,b),Z.translate(r.x,r.y),Z.rotate(-h),Z.translate(-r.x,-r.y)}else Z.fillStyle=j,Z.arc(r.x,r.y,X/2,0,U,!0),Z.fill();if(A){var S=22,H=S+"_"+u+"_"+C,e=y[H];if(e==l){var L=Ak("canvas");V.setCanvas(L,S,S);var D=L.getContext("2d"),f=S/2,O=f,x=f;V.translateAndScale(D,0,0,1),D.beginPath();var m=D.createRadialGradient(O,x,0,O,O,f);m.addColorStop(0,u),m.addColorStop(1,C),D.fillStyle=m,D.arc(O,x,f,0,U,!0),D.fill(),e=y[H]=L}var P=c/2;Y.drawImage(Z,e,r.x-P,r.y-P,c,c,b)}},E._80o=function(G){f.call(this,G);var t=this,z=t._data,j=t.gv;z.s(Z)&&j.$7e!=l&&Sb.call(t,G)},y._80o=function(M){D.call(this,M);var V=this,B=V._data,Y=V.gv;B.s(Z)&&Y.$7e!=l&&Sb.call(V,M)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);