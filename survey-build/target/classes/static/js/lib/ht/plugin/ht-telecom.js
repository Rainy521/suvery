!function(P,U){"use strict";var B=ht.AlarmSeverity=function(R,h,A,m,z){this.value=R,this.name=h,this.nickName=A,this.color=m,this.displayName=z};ht.Default.def("ht.AlarmSeverity",U,{toString:function(){return this.displayName||this.name}}),function(){B.severities=new ht.List,B._vm={},B._nm={},B._cp=function(e,d){if(e&&d){var u=e.value-d.value;return u>0?1:0>u?-1:0}return e&&!d?1:!e&&d?-1:0},B.each=function(d,S){B.severities.each(d,S)},B.getSortFunction=function(){return B._cp},B.setSortFunction=function(V){B._cp=V,B.severities.sort(V)},B.add=function(X,o,z,f,A){var C=new B(X,o,z,f,A);return B._vm[X]=C,B._nm[o]=C,B.severities.add(C),B.severities.sort(B._cp),C},B.remove=function(m){var N=B._nm[m];return N&&(delete B._nm[m],delete B._vm[N.value],B.severities.remove(N)),N},B.CRITICAL=B.add(500,"Critical","C","#FF0000"),B.MAJOR=B.add(400,"Major","M","#FFA000"),B.MINOR=B.add(300,"Minor","m","#FFFF00"),B.WARNING=B.add(200,"Warning","W","#00FFFF"),B.INDETERMINATE=B.add(100,"Indeterminate","N","#C800FF"),B.CLEARED=B.add(0,"Cleared","R","#00FF00"),B.isClearedAlarmSeverity=function(X){return X?0===X.value:!1},B.getByName=function(S){return B._nm[S]},B.getByValue=function(b){return B._vm[b]},B.clear=function(){B.severities.clear(),B._vm={},B._nm={}},B.compare=function(H,W){return B._cp(H,W)}}();var m=ht.AlarmState=function(p){this._d=p,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",U,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var M=null;for(var O in this._am)O=B.getByName(O),B.isClearedAlarmSeverity(O)||0!==this.getAcknowledgedAlarmCount(O)&&(M=M?B.compare(M,O)>0?M:O:O);this._haa=M},_c2:function(){var E=null;for(var Q in this._nm)Q=B.getByName(Q),B.isClearedAlarmSeverity(Q)||0!==this.getNewAlarmCount(Q)&&(E=E?B.compare(E,Q)>0?E:Q:Q);this._hna=E},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var d in this._nm)if(d=B.getByName(d),!B.isClearedAlarmSeverity(d)&&0!==this.getNewAlarmCount(d)&&B.compare(this._hna,d)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var a=this._haa,e=this._hna,s=this._ps;this._hoa=a,B.compare(e,this._hoa)>0&&(this._hoa=e),B.compare(s,this._hoa)>0&&(this._hoa=s)},_c5:function(){var O=this._haa,$=this._hna;this._hta=O,B.compare($,this._hta)>0&&(this._hta=$)},increaseAcknowledgedAlarm:function(U,s){if(0!==s){s=s||1;var w=this._am[U.name]||0;w+=s,this._am[U.name]=w,this._f()}},increaseNewAlarm:function(D,y){if(0!==y){y=y||1;var R=this._nm[D.name]||0;R+=y,this._nm[D.name]=R,this._f()}},decreaseAcknowledgedAlarm:function(H,a){if(0!==a){a||(a=1);var c=this._am[H.name]||0;if(c-=a,0>c)throw"Alarm count can not be negative";this._am[H.name]=c,this._f()}},decreaseNewAlarm:function(y,W){if(0!==W){W||(W=1);var x=this._nm[y.name]||0;if(x-=W,0>x)throw"Alarm count can not be negative";this._nm[y.name]=x,this._f()}},acknowledgeAlarm:function(j){this.decreaseNewAlarm(j,1),this.increaseAcknowledgedAlarm(j,1)},acknowledgeAllAlarms:function(v){if(v){var x=this.getNewAlarmCount(v);this.decreaseNewAlarm(v,x),this.increaseAcknowledgedAlarm(v,x)}else for(var E in this._nm)this.acknowledgeAllAlarms(B.getByName(E))},_c6:function(){this._aac=0;for(var x in this._am)x=B.getByName(x),this._aac+=this.getAcknowledgedAlarmCount(x)},getAcknowledgedAlarmCount:function(a){return a?this._am[a.name]||0:this._aac},getAlarmCount:function(o){return this.getAcknowledgedAlarmCount(o)+this.getNewAlarmCount(o)},_c7:function(){this._nac=0;for(var U in this._nm)this._nac+=this.getNewAlarmCount(B.getByName(U))},getNewAlarmCount:function(H){return H?this._nm[H.name]||0:this._nac},setNewAlarmCount:function(M,B){this._nm[M.name]=B,this._f()},removeAllNewAlarms:function(b){b?delete this._nm[b]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(X,U){this._am[X.name]=U,this._f()},removeAllAcknowledgedAlarms:function(G){G?delete this._am[G.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(X){if(this._ep||(X=null),this._ps!==X){var l=this._ps;this._ps=X,this._f(),this._d.fp("propagateSeverity",l,X)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(n){var F=this._ep;this._ep=n,this._d.fp("enablePropagation",F,n)&&(n||this.setPropagateSeverity(null))}});var t=ht.AlarmStatePropagator=function(T){this._dataModel=T,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",U,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(Q){this._enable!==Q&&(this._enable=Q,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(Q){this.propagate(Q)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(n){n.data&&this.propagate(n.data)},handleDataPropertyChange:function(f){if("alarmState"===f.property||"enablePropagation"===f.property)this.propagate(f.data);else if("parent"===f.property){var _=f.oldValue;_&&this.propagate(_),this.propagate(f.data)}},propagate:function($){$&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop($),this._isPropagating=!1)},propagateToTop:function(d){for(this.propagateToParent(null,d);d&&d.getParent();)this.propagateToParent(d,d.getParent()),d=d.getParent()},propagateToParent:function(I,D){var o=null;D.getChildren().each(function(f){var Q=f.getAlarmState().getHighestOverallAlarmSeverity();B.compare(Q,o)>0&&(o=Q)}),D.getAlarmState().setPropagateSeverity(o)}}),ht.AlarmStateStatistics=function(Z){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(Z)},ht.Default.def("ht.AlarmStateStatistics",U,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(a){var b=this._dataModel;b!==a&&(b&&(b.umd(this.handleDataPropertyChange,this),b.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=a,this.reset(),a.md(this.handleDataPropertyChange,this),a.mm(this.handleDataModelChange,this),this.fp("dataModel",b,a))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(H){"alarmState"===H.property&&(this.increase(H.data),this.fireAlarmStateChange())},handleDataModelChange:function(H){"add"===H.kind?(this.increase(H.data),this.fireAlarmStateChange()):"remove"===H.kind?(this.decrease(H.data),this.fireAlarmStateChange()):"clear"===H.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,B.each(function(u){var a=this.getSumInfo(u);this.sumAcked+=a.ackedCount,this.sumNew+=a.newCount,this.sumTotal+=a.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(j){if(!j)return this.sumNew;var W=this.getSumInfo(j);return W.newCount},getAcknowledgedAlarmCount:function(p){if(!p)return this.sumAcked;var J=this.getSumInfo(p);return J.ackedCount},getTotalAlarmCount:function(x){if(!x)return this.sumTotal;var c=this.getSumInfo(x);return c.totalCount},getSumInfo:function(s){var G=this.severtiyMap[s.name];return G||(G={},G.newCount=0,G.ackedCount=0,G.totalCount=0,this.severtiyMap[s.name]=G),G},decrease:function(R){var w=this.dataMap[R.getId()];w&&(delete this.dataMap[R.getId()],B.each(function(b){var t=w[b.name],q=this.getSumInfo(b);q.newCount=q.newCount-t.newCount,q.ackedCount=q.ackedCount-t.ackedCount,q.totalCount=q.totalCount-t.totalCount},this))},increase:function(C){if(this.decrease(C),!this._filterFunc||this._filterFunc(C)){var p={},c=C.getAlarmState();this.dataMap[C.getId()]=p,B.each(function(q){var m={};m.newCount=c.getNewAlarmCount(q),m.ackedCount=c.getAcknowledgedAlarmCount(q),m.totalCount=c.getAlarmCount(q),p[q.name]=m;var o=this.getSumInfo(q);o.newCount=o.newCount+m.newCount,o.ackedCount=o.ackedCount+m.ackedCount,o.totalCount=o.totalCount+m.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(f){var $=this._filterFunc;this._filterFunc=f,this.reset(),this.firePropertyChange("filterFunc",$,f)},getFilterFunc:function(){return this._filterFunc}});var d=ht.Data.prototype;d.getAlarmState=function(){return this._alarmState||(this._alarmState=new m(this))},d=ht.DataModel.prototype,d.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},d.setEnableAlarmStatePropagator=function(g){g!=this.isEnableAlarmStatePropagator()&&(g?(this._alarmStatePropagator=new t(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},d=ht.graph.GraphView.prototype,d.getNote2=function(i){var t=i.getAlarmState().getHighestNewAlarmSeverity();if(t){var b=i.getAlarmState().getNewAlarmCount(t)+t.nickName;return i.getAlarmState().hasLessSevereNewAlarms()&&(b+="+"),b}return i.s("note2")},d.getNote2Background=function(d){var V=d.getAlarmState().getHighestNewAlarmSeverity();return V?V.color:d.s("note2.background")},d.getBodyColor=function(h){var M=h.getAlarmState().getHighestNativeAlarmSeverity();return M?M.color:h.s("body.color")},d.getBorderColor=function(P){var A=P.getAlarmState().getPropagateSeverity();return A?A.color:P.s("border.color")},d=ht.widget.TreeView.prototype,d.getBorderColor=function(F){var Y=F.getAlarmState().getPropagateSeverity();return Y?Y.color:F.s("border.color")},d.getIcon=function(C){return C.getIcon()?"__alarmIcon__":null},d=ht.widget.TreeTableView.prototype,d.getBorderColor=function(j){var l=j.getAlarmState().getPropagateSeverity();return l?l.color:j.s("border.color")},d.getIcon=function(i){return i.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(T){return T.getIcon()}},color:{func:function($){var F=$.getAlarmState().getHighestNativeAlarmSeverity();return F?F.color:$.s("body.color")}},rect:[0,0,16,16]}]});var H=ht.Style;H["note2.expanded"]=!0,H["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);