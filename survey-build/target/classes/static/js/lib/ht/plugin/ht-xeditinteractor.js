!function(K,V,T){"use strict";var e="ht",L=K[e],m=L.Default,k=L.graph,B=m.getInternal(),j=B.ui(),S=j.NodeUI.prototype,A=j.ShapeUI.prototype,I=k.GraphView,$=I.prototype,v=j.EdgeUI.prototype,J=L.Node,R=L.Shape,_=L.Edge,U=L.Group,n=m.isTouchable,f=m.preventDefault,z=K.setTimeout,y=m.grow,t=m.isDragging,x=m.getDistance,q=null,D=L.List,E="undefined"!=typeof Float32Array?Float32Array:Array,g=Math,Y=g.PI,l="Crossing",Z="No Crossing",s=Y/2,C=2*Y,d=g.atan2,M=g.sqrt,a=g.pow,r=g.sin,c=g.cos,u=g.min,F=g.max,p=g.abs,P=g.ceil,Q=g.round,O=m.unionPoint,N=m.unionRect,W=m.containsPoint,H=m.clone,o="rgb(52, 152, 219)",b="red",i={northwest:0,north:1,northeast:2,west:7,east:3,southwest:6,south:5,southeast:4},G={width:400,height:100,comps:[{type:"shape",points:{func:function(){for(var n=[10,8,162,36,314,37,269,2,398,49,268,98,314,58,161,60,9,91,103,49,10,8],i=0;i<n.length;i++){var P=n[i];P=0===i%2?P/400*G.width:P/100*G.height,n[i]=P}return G.width>120&&(n[4]=G.width-26,n[6]=G.width-40,n[10]=G.width-40,n[12]=G.width-26,n[18]=33),n}},segments:[1,3,2,2,2,2,3,2,2],background:"white",gradient:"linear.east",gradientColor:"red"}]},h={width:300,height:300,comps:[{type:"circle",rect:[20,0,120,120],background:o,rotation:.61},{type:"circle",rect:[200,120,70,70],background:o,rotation:.61},{type:"circle",rect:[200,220,70,70],background:o,rotation:.61},{type:"shape",points:[80,60,80,155,200,155],borderWidth:20,borderColor:o},{type:"shape",points:[80,60,80,255,200,255],borderWidth:20,borderColor:o}]},w={width:300,height:300,comps:[{type:"shape",points:[114,239,115,106,112,73,149,73,149,73,175,73,177,105,179,261,178,302,147,307,98,308,83,307,72,276,73,260,72,81,74,29,115,21,191,21,221,22,224,53,223,238],segments:[1,2,3,2,3,2,3,2,4,2,3,2,3,2],borderWidth:20,borderColor:b,rotation:.61}]},X={width:300,height:300,comps:[{type:"circle",rect:[210,0,90,90],background:o},{type:"circle",rect:[0,210,90,90],background:o},{type:"shape",points:[255,45,45,255],borderWidth:20,borderColor:o}]},cq={width:300,height:300,comps:[{type:"shape",points:[20,20,280,280],borderWidth:30,borderColor:b},{type:"shape",points:[280,20,20,280],borderWidth:30,borderColor:b}]},Rr={width:300,height:300,comps:[{type:"shape",points:[270,30,30,150,270,270],borderWidth:40,borderColor:o}]},Xp={width:300,height:300,comps:[{type:"shape",points:[30,30,270,150,30,270],borderWidth:40,borderColor:b}]},ik={width:300,height:300,comps:[{type:"rect",rect:[125.58,52.76,40,231.96],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[27.87,61.06,150,30],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000",rotation:5.5},{type:"rect",rect:[113.36,61,150,30],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000",rotation:.79}]},pl={width:300,height:300,author:"",note:"",comps:[{type:"rect",rect:[135.15,38.76,28.63,82.84],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"triangle",rect:[94.69,2.35,110,44.77],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[31.71,115.72,240,15],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[31.71,167.62,240,15],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[135.15,177.33,28.63,82.84],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"triangle",rect:[94.69,251.39,110,44.77],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000",rotation:3.14}]},Dh=function(P){var q=P.touches[0];return q?q:P.changedTouches[0]},Ok=function(Y,K,_,P){return d(P-K,_-Y)},wo=function(f,H){return{x:f.x*H,y:f.y*H}},og=function(U,E){var k,p,O,T,f=U._layers,K=U.sm().getSelection()._as,C=K.length;if(f)for(k=0;k<f.length;k++){T=f[k];for(var J=0;C>J;J++)if(p=K[J],p._layer===T&&(O=E(p),O===!1))return}else for(k=0;C>k;k++)if(p=K[k],O=E(p),O===!1)return},yc=function(e,Y,$){var h,r,l,c,y,G=this,z=Y,Q=G.gv;if(e instanceof R){l=e.getSegments();var S=Q.getDataUI(e);y=S._55O.$15l,l&&l.size()||(l=fh(y)),e.isClosePath()&&l.indexOf(5)<0&&(l=new D(l._as),l.add(5)),h=Qc(e,S,z),r=y[h]}else{var A=Q.getDataUI(e);y=xm(A,e.s("edge.points")),l=e.s("edge.segments"),l&&l.size()||(l=fh(y)),y=y._as,h=Qc(e,A,z),r=y[h]}if(l&&(c=l.get(z)),2===c||1===c||5===c){var V=y[h+1];5===c&&(V=y[0]);var m=mc(r,$,V);return m}return $},Kp=function(x,M){var e,s,f,v,V=x._layers,C=x.sm().getSelection()._as,X=C.length;if(V)for(e=V.length-1;e>=0;e--){v=V[e];for(var _=X-1;_>=0;_--)if(s=C[_],s._layer===v&&(f=M(s),f===!1))return}else for(e=X-1;e>=0;e--)if(s=C[e],f=M(s),f===!1)return},lf=function(g,K,s,d){var U=K/2,Q=s/2,R=qf(g,-U,-Q,d),X=qf(g,U,-Q,d),v=qf(g,-U,Q,d),e=qf(g,U,Q,d),c=qf(g,0,-Q,d),J=qf(g,U,0,d),n=qf(g,0,Q,d),i=qf(g,-U,0,d);return[R,X,v,e,c,J,n,i]},mc=function(Y,D,y){var n={x:D.x-Y.x,y:D.y-Y.y},i={x:y.x-Y.x,y:y.y-Y.y},e=M(a(y.x-Y.x,2)+a(y.y-Y.y,2)),z={x:i.x/e,y:i.y/e},Z=n.x*z.x+n.y*z.y,W={x:z.x*Z,y:z.y*Z};return{x:Y.x+W.x,y:Y.y+W.y}},qf=function(x,Y,Z,g){var P=c(g)*Y-r(g)*Z,F=r(g)*Y+c(g)*Z;return x?{x:x.x+P,y:x.y+F}:{x:P,y:F}},gb=function(c,T){return T>2*c?c:T/2},po=function(q,p,D,O){var R=x(q,p);return D=O?u(D,R):gb(D,R),R?D/=R:D=0,{x:q.x+(p.x-q.x)*D,y:q.y+(p.y-q.y)*D}},np=function(f,j){var r,a,y=f.gv,Y=f._data,N=Y._40I,l=Y._41I,m=Y.s("edge.offset"),J=Y.s("edge.source.position"),k=Y.s("edge.target.position"),A=Y.s("edge.source.offset.x"),s=Y.s("edge.source.offset.y"),q=Y.s("edge.target.offset.x"),n=Y.s("edge.target.offset.y"),U=Y.s("edge.source.anchor.x"),w=Y.s("edge.source.anchor.y"),E=Y.s("edge.target.anchor.x"),Q=Y.s("edge.target.anchor.y");if(j?(r=B.getEdgeAgentPosition(y,N,J,A,s,U,w),a=B.getEdgeAgentPosition(y,l,k,q,n,E,Q)):(r=B.getEdgeAgentPosition(y,N,J,0,0,U,w),a=B.getEdgeAgentPosition(y,l,k,0,0,E,Q)),"points"===Y.s("edge.type")&&m&&!Y.s("edge.center")&&r){var O=Y.s("edge.points")||new D,u=O.size(),W=po(r,u?O.get(0):a,m,u),L=po(a,u?O.get(u-1):r,m,u);r=W,a=L}return[r,a]},xm=function(r,J,b){var R=r._78o,M=r._data,m=M.s("edge.type"),h=[R.sourcePoint,R.targetPoint];return"points"===m?b&&(h=np(r)):h=R.center?m?b?np(r):np(r,!0):b?np(r):[R.c1,R.c2]:b?np(r):np(r,!0),J=new D(J?J._as:q),J.add(h[0],0),J.add(h[1]),J},wl=function(o){return o=new D(o._as),o.removeAt(0),o.removeAt(o.size()-1),o},fh=function(w){w._as||(w=new D(w));var a=new D;a.add(1);for(var m=1;m<w.size();m++)a.add(2);return a},vs=function(a,b){return{x:(a.x+b.x)/2,y:(a.y+b.y)/2}},rd=function(H,Q){return{x:H.x+1*(Q.x-H.x)/4,y:H.y+1*(Q.y-H.y)/4}},El=function(H,k){return{x:H.x+3*(k.x-H.x)/4,y:H.y+3*(k.y-H.y)/4}},_p=function(A,z,a,F){var o=z.x+z.width/2,e=z.y+z.height/2,t=M(o*o+e*e),i=d(e,o)+a;return{x:F.x+t*c(i),y:F.y+t*r(i)}},bm=$.validateImpl,gl=$.isRectEditable,Qh=$.isPointEditable,Pi=$._42,zp=A._79o,sm=v._79o,Ip=A._48O,Wh=A._47O,No=S._48O,jg=S._80o,Of=A._80o,_i=S.getSelectWidth,Gi=S._47O,Vb=v._47O,uo=$.isEditable,$b=["northwest","north","northeast","east","southeast","south","southwest","west"],ih=function(B,x,i,k,W,X,I,Z,t,r){var D=B.x,A=B.y,R=B.width,Y=B.height,S={x:D+R/2,y:A+Y/2};k=k||0,x=qf(S,x.x-S.x,x.y-S.y,-k),I&&!Z&&(x.x+=t,x.y+=r);var s=.01;if("northwest"===i?(x.x+W>D+R-s&&(x.x=D+R-W-s),x.y+W>A+Y-s&&(x.y=A+Y-W-s),B=O(x,{x:D+R,y:A+Y})):"north"===i?(x.y+W>A+Y-s&&(x.y=A+Y-W-s),B=O({x:D,y:x.y},{x:D+R,y:A+Y})):"northeast"===i?(x.x<D+W+s&&(x.x=D+W+s),x.y+W>A+Y-s&&(x.y=A+Y-W-s),B=O({x:D,y:x.y},{x:x.x,y:A+Y})):"west"===i?(x.x+W>D+R-s&&(x.x=D+R-W-s),B=O({x:x.x,y:A},{x:D+R,y:A+Y})):"east"===i?(x.x<D+W+s&&(x.x=D+W+s),B=O({x:D,y:A},{x:x.x,y:A+Y})):"southwest"===i?(x.x+W>D+R-s&&(x.x=D+R-W-s),x.y<A+W+s&&(x.y=A+W+s),B=O({x:x.x,y:A},{x:D+R,y:x.y})):"south"===i?(x.y<A+W+s&&(x.y=A+W+s),B=O({x:D,y:A},{x:D+R,y:x.y})):"southeast"===i&&(x.x<D+W+s&&(x.x=D+W+s),x.y<A+W+s&&(x.y=A+W+s),B=O({x:D,y:A},x)),"keepRatio"===X&&(!I&&Z||I&&!Z)&&("northeast"===i||"southeast"===i||"northwest"===i||"southwest"===i)){var C=B.width,f=B.height,Q=C/R,b=f/Y,U=u(Q,b);B.width=R*U,B.height=Y*U,"northeast"===i?B.y=A+(Y-B.height):"northwest"===i?(B.y=A+(Y-B.height),B.x=D+(R-B.width)):"southwest"===i&&(B.x=D+(R-B.width))}B.x-=S.x,B.y-=S.y;var p=_p(q,B,k,S);return B.x=p.x-B.width/2,B.y=p.y-B.height/2,B},gr=function(j,C,G,$){var Z=j.getRotation(),Q=C,h=Q.x,K=Q.y,M=Q.width,A=Q.height,n={x:h+Q.width/2,y:K+Q.height/2};$=qf(n,$.x-n.x,$.y-n.y,-Z),"northwest"===G?Q=O($,{x:h+M,y:K+A}):"north"===G?Q=O({x:h,y:$.y},{x:h+M,y:K+A}):"northeast"===G?Q=O({x:h,y:$.y},{x:$.x,y:K+A}):"west"===G?Q=O({x:$.x,y:K},{x:h+M,y:K+A}):"east"===G?Q=O({x:h,y:K},{x:$.x,y:K+A}):"southwest"===G?Q=O({x:$.x,y:K},{x:h+M,y:$.y}):"south"===G?Q=O({x:h,y:K},{x:h+M,y:$.y}):"southeast"===G&&(Q=O({x:h,y:K},$)),j.setRect(Q),Q.x-=n.x,Q.y-=n.y;var X=_p(j,Q,Z,n);j.p(X.x,X.y)},Re=function(v,X,n,E,s,F,V,w){var C=q;F?(C=qf(q,s.x-X.x,s.y-X.y,-n),C.x-=V.x,C.y-=V.y):C=qf(q,s.x-X.x,s.y-X.y,0);var L={x:X.x+C.x,y:X.y+C.y};w&&(L=w(L.x,L.y)),L.e=v.getPoints().get(E).e,v.setPoint(E,L);var B=v.getWidth(),I=v.getHeight(),y=v.p().x-B/2,p=v.p().y-I/2;y-=X.x,p-=X.y;var U=_p(v,{x:y,y:p,width:B,height:I},n,X);v.p(U.x,U.y)},Qc=function(u,i,j){var J,U;if(u instanceof R?(J=u.getPoints(),U=u.getSegments()):u instanceof _&&"points"===u.s("edge.type")&&(J=u.s("edge.points"),U=u.s("edge.segments"),J=xm(i,J)),U&&U.size()||(U=fh(J)),u instanceof R&&u.isClosePath()&&U.indexOf(5)<0&&(U=new D(U._as),U.add(5)),U)for(var L=-1,C=0;C<U.size();C++){if(C===j)return L;var l=U.get(C);1===l?L+=1:2===l?L+=1:3===l?L+=2:4===l&&(L+=3)}},Lg=function(t,X,x){var F,e;if(t instanceof R?(F=t.getPoints(),e=t.getSegments()):t instanceof _&&"points"===t.s("edge.type")&&(F=t.s("edge.points"),e=t.s("edge.segments"),F=xm(X,F)),e&&e.size()||(e=fh(F)),e)for(var o=-1,y=0;y<e.size();y++){var E=e.get(y);if(1===E?o+=1:2===E?o+=1:3===E?o+=2:4===E&&(o+=3),o===x)return y}},ks=function(E,e){var Q=[E[0]-e[0],E[1]-e[1],E[2]-e[2]];return Q},Jg=function(){var W=new E(16);return W[0]=1,W[1]=0,W[2]=0,W[3]=0,W[4]=0,W[5]=1,W[6]=0,W[7]=0,W[8]=0,W[9]=0,W[10]=1,W[11]=0,W[12]=0,W[13]=0,W[14]=0,W[15]=1,W},Ef=function(F,Z){var M=F[0],h=F[1],f=F[2];return F[0]=Z[0]*M+Z[4]*h+Z[8]*f+Z[12],F[1]=Z[1]*M+Z[5]*h+Z[9]*f+Z[13],F[2]=Z[2]*M+Z[6]*h+Z[10]*f+Z[14],F},mh=function(S,Y){if(Y){var l=r(Y),k=c(Y),z=S[0],A=S[1],f=S[2],t=S[3],R=S[8],s=S[9],H=S[10],y=S[11];S[0]=z*k-R*l,S[1]=A*k-s*l,S[2]=f*k-H*l,S[3]=t*k-y*l,S[8]=z*l+R*k,S[9]=A*l+s*k,S[10]=f*l+H*k,S[11]=t*l+y*k}},On=function(v,f){for(var N=v.s("grid.row.count"),S=v.s("grid.column.count"),V=0;N>V;V++)for(var _=0;S>_;_++){var m=v.getCellRect(V,_);if(W(m,f))return{rowIndex:V,columnIndex:_,rect:m,grid:v}}return null},mq=function(d,B,N,C,W,a){var q={},j=N-d,P=C-B,R=g.sqrt(j*j+P*P),L=j/R,y=P/R,Y=(-d+W)*L+(-B+a)*y;return 0>=Y?(q.x=d,q.y=B):Y>=R?(q.x=N,q.y=C):(q.x=d+Y*L,q.y=B+Y*y),j=W-q.x,P=a-q.y,q.z=g.sqrt(j*j+P*P),q},xr=function(n,f){var A,z,c,j,D,l,B,s,O=n.getPoints(),Q=n.getSegments(),w=n.p(),C=n.getRotation();if(!Q||!(Q.indexOf(3)>0||Q.indexOf(4)>0)){for(s=0;s<=O.size()-1;s++)if(s===O.size()-1?(D=O.get(0),j=O.get(s)):(j=O.get(s),D=O.get(s+1)),j=qf(w,j.x-w.x,j.y-w.y,C),D=qf(w,D.x-w.x,D.y-w.y,C),l=mq(j.x,j.y,D.x,D.y,f.x,f.y),B=l.z,B<(n.s("shape.border.width")||10)){z=j,c=D,A=s;break}if(A!=q){var V=mq(z.x,z.y,c.x,c.y,f.x,f.y),g=x(z,V);return{attachIndex:A,attachOffset:g}}}},ne=function(S){for(var c=S._data,u=c.p(),K=c.getRotation(),L=c.getPoints(),H=q,C=[],U=0;U<L.size();U++)H=L.get(U),C.push(qf(u,H.x-u.x,H.y-u.y,K));S._55O.$15l=C};m.setImage("xeditinteractor_parentIcon",h),m.setImage("xeditinteractor_hostIcon",w),m.setImage("xeditinteractor_edgeIcon",X),m.setImage("xeditinteractor_removeIcon",cq),m.setImage("xeditinteractor_sourceIcon",Rr),m.setImage("xeditinteractor_targetIcon",Xp),m.setImage("xeditinteractor_elevationIcon",ik),m.setImage("xeditinteractor_tallIcon",pl),$._editPointSize=n?24:9,$._edgeHelpers=["parent","remove","source","target"],$._leftTopHelpers=["parent"],$._rightTopHelpers=["host"],$._leftBottomHelpers=["edge"],$._rightBottomHelpers=["remove"],$b=$b.concat($b).concat($b),v._79o=function(){var q=this,$=q.gv,X=$.getZoom(),m=$._editInteractor,G=sm.call(q);if(!G)return null;var u=np(q,!0),B=u[0],h=u[1],U={x:G.x,y:G.y,width:G.width,height:G.height},L=O(B,h);if(m instanceof k.XEditInteractor){U=N(U,L);var W=q._55O,D=$.getEditPointSize()/X+2,g=0;W&&W._43O&&(g+=D/2,y(U,g))}return U},v._47O=function(W){var f=this,Q=f.gv,E=Q._editInteractor;E instanceof k.XEditInteractor||Vb.call(f,W)},v.rectIntersects=function(I){var Q=this,W=Q._data,o=Q.gv,U=o.getZoom(),s=Q._55O,a=o._editInteractor;if(a instanceof k.XEditInteractor&&o.isEditable(W)&&s&&s._43O&&"points"===W.s("edge.type")){var R=W.s("edge.points"),j=W.s("edge.segments");R=xm(Q,R),j&&j.size()||(j=fh(R)),R=R._as;var X=!1,P=n?5:1,Z=I.x+P,J=I.y+P,H={x:Z,y:J};if(a._edge===W&&a._hoverSegmentIndex>=0){var $=o._editInteractor._hoverSegmentIndex,d=j.get($),y=Qc(W,Q,$),C=q;if(y!=q&&y>=0){var K=R[y],w=o.getSegmentHoverWidth()/U;if(2===d||1===d){var T=R[y+1];C=km(new hr(K.x,K.y),new hr(T.x,T.y),new hr(H.x-w,H.y-w),new hr(H.x+2*w,H.y+2*w)),C.$62l===l&&(X=!0)}else if(3===d){var A=R[y+1],T=R[y+2];C=Up(new hr(K.x,K.y),new hr(A.x,A.y),new hr(T.x,T.y),new hr(H.x-w,H.y-w),new hr(H.x+2*w,H.y+2*w)),C.$62l===l&&(X=!0)}else if(4===d){var B=R[y+1],S=R[y+2];T=R[y+3],C=io(new hr(K.x,K.y),new hr(B.x,B.y),new hr(S.x,S.y),new hr(T.x,T.y),new hr(H.x-w,H.y-w),new hr(H.x+2*w,H.y+2*w)),C.$62l===l&&(X=!0)}}}if(X)return!0}return q},A._47O=function(l){var j=this,m=j.gv,U=m._editInteractor;U instanceof k.XEditInteractor||Wh.call(j,l)},A.rectIntersects=function(F){var M=this,b=M._data,E=M.gv,a=E.getZoom(),c=M._55O,Y=E._editInteractor;if(Y instanceof k.XEditInteractor&&E.isEditable(b)&&c&&c._43O){var D=c.$15l,S=!1,o=n?5:1,t=F.x+o,N=F.y+o,u={x:t,y:N};if(D&&D.length===b.getPoints().size()||(ne(M),D=c.$15l),Y._shape===b&&Y._hoverSegmentIndex>=0){var m=b.getSegments();m&&m.size()||(m=fh(D));var h=E._editInteractor._hoverSegmentIndex,v=m.get(h),O=Qc(b,M,h),y=q;if(O!=q&&O>=0){var W=D[O],z=E.getSegmentHoverWidth()/a;if(2===v||1===v){var w=D[O+1];y=km(new hr(W.x,W.y),new hr(w.x,w.y),new hr(u.x-z,u.y-z),new hr(u.x+2*z,u.y+2*z)),y.$62l===l&&(S=!0)}else if(3===v){var Z=D[O+1],w=D[O+2];y=Up(new hr(W.x,W.y),new hr(Z.x,Z.y),new hr(w.x,w.y),new hr(u.x-z,u.y-z),new hr(u.x+2*z,u.y+2*z)),y.$62l===l&&(S=!0)}else if(4===v){var C=D[O+1],e=D[O+2];w=D[O+3],y=io(new hr(W.x,W.y),new hr(C.x,C.y),new hr(e.x,e.y),new hr(w.x,w.y),new hr(u.x-z,u.y-z),new hr(u.x+2*z,u.y+2*z)),y.$62l===l&&(S=!0)}}}if(S)return!0}return q},A._48O=function(){var N=this,L=N.gv,q=L._editInteractor;q instanceof k.XEditInteractor?(S._48O.call(N),N._55O._43O&&ne(N)):Ip.call(N)},A._79o=function(){var F=this,d=F.gv,s=d.getZoom(),c=d._editInteractor,x=zp.call(F);if(x){var p={x:x.x,y:x.y,width:x.width,height:x.height};if(c instanceof k.XEditInteractor){var I=F._55O,u=d.getEditPointSize()/s+2,X=0;I&&I._43O&&(X+=u/2,y(p,X))}return p}},S._47O=function(G){var U=this,L=U.gv,F=L._editInteractor;if(F instanceof k.XEditInteractor);else{var d=U._55O;d&&d._98o&&Gi.call(U,G)}},S.getSelectWidth=function(){var r=this,R=r.gv,y=R._editInteractor,X=r._data;return R.isEditable(X)&&y instanceof k.XEditInteractor?0:_i.call(r)},S._80o=function(M){var u=this,d=u.gv._editInteractor;if(jg.call(u,M),d&&d._debug){M.save(),M.beginPath(),M.lineWidth=1,M.strokeStyle="green";var T=u._79o();T&&(M.rect(T.x,T.y,T.width,T.height),M.stroke()),M.restore()}},A._80o=function(d){var r=this,G=r.gv._editInteractor;if(Of.call(r,d),G&&G._debug){d.save(),d.beginPath(),d.lineWidth=1,d.strokeStyle="green";var T=r._79o();d.rect(T.x,T.y,T.width,T.height),d.stroke(),d.restore()}},S._48O=function(){var N=this,q=N.gv,r=N._data,m=q._editInteractor,c=N._55O,B=r.p(),l=r.getRotation();if(m instanceof k.XEditInteractor){if(c._42O){var G=lf(B,r.getWidth(),r.getHeight(),l),g=G[0],x=G[1],J=G[2],Z=G[3],P=G[4],A=G[5],Y=G[6],K=G[7];c.$45l=[g,P,x,A,Z,Y,J,K]}}else No.call(N)},$.getResizeMode=function(){return this.$25l||"normal"},$.setResizeMode=function(t){var y=this.$25l;this.$25l=t,this.fp("resizeMode",y,t)},$.getSnapAngle=function(){return this.$26l||Math.PI/36},$.setSnapAngle=function(F){var m=this.$26l;this.$26l=F,this.fp("snapAngle",m,F)},$.getSnapSpacing=function(){return this.$27l},$.setSnapSpacing=function(K){var A=this.$27l;this.$27l=K,this.fp("snapSpacing",A,K)},$.getPointSnapSpacing=function(){return this._pointSnapSpacing},$.setPointSnapSpacing=function(l){var Q=this._pointSnapSpacing;this._pointSnapSpacing=l,this.fp("pointSnapSpacing",Q,l)},$.setHelperEditableFunc=function(a){var g=this._helperEditableFunc;this._helperEditableFunc=a,this.fp("helperEditableFunc",g,a)},$.getHelperEditableFunc=function(){return this._helperEditableFunc},$.setLeftTopHelpers=function(L){var Z=this._leftTopHelpers;this._leftTopHelpers=L,this.fp("leftTopHelpers",Z,L)},$.getLeftTopHelpers=function(){return this._leftTopHelpers},$.setLeftTopHelpersAlign=function(v){var x=this._leftTopHelpersAlign;this._leftTopHelpersAlign=v,this.fp("leftTopHelpersAlign",x,v)},$.getLeftTopHelpersAlign=function(){return this._leftTopHelpersAlign},$.setRightTopHelpers=function(o){var H=this._rightTopHelpers;this._rightTopHelpers=o,this.fp("rightTopHelpers",H,o)},$.getRightTopHelpers=function(){return this._rightTopHelpers},$.setRightTopHelpersAlign=function(T){var Z=this._rightTopHelpersAlign;this._rightTopHelpersAlign=T,this.fp("rightTopHelpersAlign",Z,T)},$.getRightTopHelpersAlign=function(){return this._rightTopHelpersAlign},$.setLeftBottomHelpers=function(D){var n=this._leftBottomHelpers;this._leftBottomHelpers=D,this.fp("leftBottomHelpers",n,D)},$.getLeftBottomHelpers=function(){return this._leftBottomHelpers},$.setLeftBottomHelpersAlign=function(H){var N=this._leftBottomHelpersAlign;this._leftBottomHelpersAlign=H,this.fp("leftBottomHelpersAlign",N,H)},$.getLeftBottomHelpersAlign=function(){return this._leftBottomHelpersAlign},$.setRightBottomHelpers=function(l){var _=this._rightBottomHelpers;this._rightBottomHelpers=l,this.fp("rightBottomHelpers",_,l)},$.getRightBottomHelpers=function(){return this._rightBottomHelpers},$.setRightBottomHelpersAlign=function(h){var P=this._rightBottomHelpersAlign;this._rightBottomHelpersAlign=h,this.fp("rightBottomHelpersAlign",P,h)},$.getRightBottomHelpersAlign=function(){return this._rightBottomHelpersAlign},$.setEdgeHelpers=function($){var m=this._edgeHelpers;this._edgeHelpers=$,this.fp("edgeHelpers",m,$)},$.getEdgeHelpers=function(){return this._edgeHelpers},$.isHelperEditable=function(Q,V){return Q instanceof _&&("host"===V||"edge"===V||"elevation"===V||"tall"===V)?!1:Q instanceof J&&("source"===V||"target"===V)?!1:"pointElevation"===V?this._helperEditableFunc?this._helperEditableFunc(Q,V):!1:this._helperEditableFunc?this._helperEditableFunc(Q,V):!0},$.getEditHelperSize=function(){return this._editHelperSize||(n?28:16)},$.setEditHelperSize=function(O){var y=this._editHelperSize;this._editHelperSize=O,this.fp("editHelperSize",y,O)},$.getEditRectBorderColor=function(){return this.$28l||"rgb(0, 168, 255)"},$.setEditRectBorderColor=function(m){var b=this.$28l;this.$28l=m,this.fp("editRectBorderColor",b,m)},$.getNodeBorderColor=function(){return this.$29l||"#1ABC9C"},$.setNodeBorderColor=function(R){var k=this.$29l;this.$29l=R,this.fp("nodeBorderColor",k,R)},$.getEditRectBorderStyle=function(){return this.$30l||"dashed"},$.setEditRectBorderStyle=function(N){var S=this.$30l;this.$30l=N,this.fp("editRectBorderStyle",S,N)},$.getControlPointBackground=function(){return this.$31l||"#ff0"},$.setControlPointBackground=function(n){var f=this.$31l;this.$31l=n,this.fp("controlPointBackground",f,n)},$.getControlPointBorderColor=function(){return this.$32l||this._editPointBorderColor},$.setControlPointBorderColor=function(P){var u=this.$32l;this.$32l=P,this.fp("controlPointBorderColor",u,P)},$.getJoinPointBackground=function(){return this.$33l||this._editPointBackground},$.setJoinPointBackground=function(r){var G=this.$33l;this.$33l=r,this.fp("joinPointBackground",G,r)},$.getJoinPointBorderColor=function(){return this.$34l||this._editPointBorderColor},$.setJoinPointBorderColor=function(i){var $=this.$34l;this.$34l=i,this.fp("joinPointBorderColor",$,i)},$.getDirectionLineColor=function(){return this.$35l||"#888"},$.setDirectionLineColor=function(X){var G=this.$35l;this.$35l=X,this.fp("directionLineColor",G,X)},$.getSegmentHoverColor=function(){return this.$36l||"rgba(255, 0, 0, 0.3)"},$.setSegmentHoverColor=function(F){var j=this.$36l;this.$36l=F,this.fp("segmentHoverColor",j,F)},$.getSegmentHoverWidth=function(){return this.$22l||(n?16:8)},$.setSegmentHoverWidth=function(X){var u=this.$22l;this.$22l=X,this.fp("segmentHoverWidth",u,X)},$.getSnapPointBorderColor=function(){return this.$38l||"#f00"},$.setSnapPointBorderColor=function(q){var g=this.$38l;this.$38l=q,this.fp("snapPointBorderColor",g,q)},$.getEditRectPadding=function(){return this.$39l!=q?this.$39l:6},$.setEditRectPadding=function(h){var B=this.$39l;this.$39l=h,this.fp("editRectPading",B,h)},$.isRectEditable=function(P){var W=this,q=W._editInteractor;return q instanceof k.XEditInteractor?W._rectEditableFunc?W._rectEditableFunc(P):!0:gl.call(W,P)},$.isPointEditable=function(D){var R=this,S=R._editInteractor;return S instanceof k.XEditInteractor?R._pointEditableFunc?R._pointEditableFunc(D):!0:Qh.call(R,D)},$.validateImpl=function(){var z=this,k=z.$14l,o=z._editInteractor;if(k){var X=z.getWidth(),v=z.getHeight();(X!==k.clientWidth||v!==k.clientHeight)&&(o&&(o._68I=1),B.setCanvas(k,X,v),z._32I=1)}bm.call(this)},$.isEditable=function(u){var i=uo.call(this,u),U=this._editInteractor;if(U instanceof k.XEditInteractor&&u instanceof _){if(!u.s("2d.editable"))return!1;var h=this.getEditableFunc();i=h?h(u):!0}return i},$._42=function(P,o){var i=this,g=i._editInteractor;Pi.call(i,P,o),g instanceof k.XEditInteractor&&g._68I&&g._42()},$.isSnapPoint=function(){return!0};var _g=function(s){arguments.length>0&&this.$58l(s)},_f=_g.prototype;_f.$58l=function(C){this.$62l=C,this.points=new Array},_f.$56l=function(m){this.points.push(m)},_f.$57l=function(H){this.points=this.points.concat(H)};var hr=function(q,N){arguments.length>0&&this.$58l(q,N)},tq=hr.prototype;tq.$58l=function(s,E){this.x=s,this.y=E},tq.add=function(X){return new hr(this.x+X.x,this.y+X.y)},tq.addEquals=function(G){return this.x+=G.x,this.y+=G.y,this},tq.$55l=function(U){return new hr(this.x*U,this.y*U)},tq.eq=function(Q){return this.x==Q.x&&this.y==Q.y},tq.lt=function(o){return this.x<o.x&&this.y<o.y},tq.lte=function(h){return this.x<=h.x&&this.y<=h.y},tq.gt=function(D){return this.x>D.x&&this.y>D.y},tq.gte=function(i){return this.x>=i.x&&this.y>=i.y},tq.lerp=function(n,v){return new hr(this.x+(n.x-this.x)*v,this.y+(n.y-this.y)*v)},tq.distanceFrom=function(u){var Q=this.x-u.x,N=this.y-u.y;return M(Q*Q+N*N)},tq.min=function(N){return new hr(u(this.x,N.x),u(this.y,N.y))},tq.max=function(k){return new hr(F(this.x,k.x),F(this.y,k.y))},tq.toString=function(){return this.x+","+this.y};var sd=function(){this.$58l(arguments)},Km=sd.prototype;sd.TO=1e-6,sd.AC=6,Km.$58l=function(u){this.co=new Array;for(var P=u.length-1;P>=0;P--)this.co.push(u[P])},Km.$55l=function(j){for(var h=new sd,w=0;w<=this.$50l()+j.$50l();w++)h.co.push(0);for(var w=0;w<=this.$50l();w++)for(var b=0;b<=j.$50l();b++)h.co[w+b]+=this.co[w]*j.co[b];return h},Km.$59l=function(){for(var C=this.$50l();C>=0&&p(this.co[C])<=sd.TO;C--)this.co.pop()},Km.$50l=function(){return this.co.length-1},Km.$51l=function(){var v;switch(this.$59l(),this.$50l()){case 0:v=new Array;break;case 1:v=this.$52l();break;case 2:v=this.$53l();break;case 3:v=this.$54l();break;case 4:v=this.$63l();break;default:v=new Array}return v},Km.$52l=function(){var f=new Array,c=this.co[1];return 0!=c&&f.push(-this.co[0]/c),f},Km.$53l=function(){var Y=new Array;if(2==this.$50l()){var N=this.co[2],W=this.co[1]/N,C=this.co[0]/N,y=W*W-4*C;if(y>0){var O=M(y);Y.push(.5*(-W+O)),Y.push(.5*(-W-O))}else 0==y&&Y.push(.5*-W)}return Y},Km.$63l=function(){var A=new Array;if(4==this.$50l()){var L=this.co[4],g=this.co[3]/L,l=this.co[2]/L,n=this.co[1]/L,v=this.co[0]/L,U=new sd(1,-l,g*n-4*v,-g*g*v+4*l*v-n*n).$54l(),Q=U[0],z=g*g/4-l+Q;if(p(z)<=sd.TO&&(z=0),z>0){var K=M(z),h=3*g*g/4-K*K-2*l,s=(4*g*l-8*n-g*g*g)/(4*K),H=h+s,J=h-s;if(p(H)<=sd.TO&&(H=0),p(J)<=sd.TO&&(J=0),H>=0){var f=M(H);A.push(-g/4+(K+f)/2),A.push(-g/4+(K-f)/2)}if(J>=0){var f=M(J);A.push(-g/4+(f-K)/2),A.push(-g/4-(f+K)/2)}}else if(0>z);else{var s=Q*Q-4*v;if(s>=-sd.TO){if(0>s&&(s=0),s=2*M(s),h=3*g*g/4-2*l,h+s>=sd.TO){var V=M(h+s);A.push(-g/4+V/2),A.push(-g/4-V/2)}if(h-s>=sd.TO){var V=M(h-s);A.push(-g/4+V/2),A.push(-g/4-V/2)}}}}return A},Km.$54l=function(){var V=new Array;if(3==this.$50l()){var E=this.co[3],Y=this.co[2]/E,R=this.co[1]/E,f=this.co[0]/E,v=(3*R-Y*Y)/3,l=(2*Y*Y*Y-9*R*Y+27*f)/27,N=Y/3,e=l*l/4+v*v*v/27,w=l/2;if(p(e)<=sd.TO&&(e=0),e>0){var W,g,_=M(e);W=-w+_,g=W>=0?a(W,1/3):-a(-W,1/3),W=-w-_,W>=0?g+=a(W,1/3):g-=a(-W,1/3),V.push(g-N)}else if(0>e){var q=M(-v/3),T=d(M(-e),-w)/3,B=c(T),y=r(T),$=M(3);V.push(2*q*B-N),V.push(-q*(B+$*y)-N),V.push(-q*(B-$*y)-N)}else{var W;W=w>=0?-a(w,1/3):a(-w,1/3),V.push(2*W-N),V.push(-W-N)}}return V};var ii=function(w,C){arguments.length>0&&this.$58l(w,C)},Bh=ii.prototype;Bh.$58l=function(_,d){this.x=_,this.y=d},Bh.length=function(){return M(this.x*this.x+this.y*this.y)},Bh.$60l=function(l){return this.x*l.x+this.y*l.y};var rs=function(T,q,n,O){var i,t=(O.x-n.x)*(T.y-n.y)-(O.y-n.y)*(T.x-n.x),H=(q.x-T.x)*(T.y-n.y)-(q.y-T.y)*(T.x-n.x),G=(O.y-n.y)*(q.x-T.x)-(O.x-n.x)*(q.y-T.y);if(0!=G){var v=t/G,N=H/G;v>=0&&1>=v&&N>=0&&1>=N?(i=new _g(l),i.points.push(new hr(T.x+v*(q.x-T.x),T.y+v*(q.y-T.y)))):i=new _g(Z)}else i=0==t||0==H?new _g("C"):new _g("P");return i},je=function(E,X,j,A,n){var c,a,h,S,$,N,C,F=A.min(n),k=A.max(n),R=new _g(Z);c=X.$55l(-2),h=E.add(c.add(j)),c=E.$55l(-2),a=X.$55l(2),S=c.add(a),$=new hr(E.x,E.y),C=new ii(A.y-n.y,n.x-A.x),N=A.x*n.y-n.x*A.y;for(var y=new sd(C.$60l(h),C.$60l(S),C.$60l($)+N).$51l(),d=0;d<y.length;d++){var v=y[d];if(v>=0&&1>=v){var M=E.lerp(X,v),J=X.lerp(j,v),q=M.lerp(J,v);A.x==n.x?F.y<=q.y&&q.y<=k.y&&(R.$62l=l,R.$56l(q)):A.y==n.y?F.x<=q.x&&q.x<=k.x&&(R.$62l=l,R.$56l(q)):q.gte(F)&&q.lte(k)&&(R.$62l=l,R.$56l(q))}}return R},Up=function(f,v,J,j,b){var U=j.min(b),s=j.max(b),e=new hr(s.x,U.y),g=new hr(U.x,s.y),M=je(f,v,J,U,e),I=je(f,v,J,e,s),a=je(f,v,J,s,g),d=je(f,v,J,g,U),P=new _g(Z);return P.$57l(M.points),P.$57l(I.points),P.$57l(a.points),P.$57l(d.points),P.points.length>0&&(P.$62l=l),P},cj=function(c,o,K,F,G,$){var E,s,H,X,r,I,n,i,A,B,v=G.min($),N=G.max($),t=new _g(Z);E=c.$55l(-1),s=o.$55l(3),H=K.$55l(-3),X=E.add(s.add(H.add(F))),r=new ii(X.x,X.y),E=c.$55l(3),s=o.$55l(-6),H=K.$55l(3),X=E.add(s.add(H)),I=new ii(X.x,X.y),E=c.$55l(-3),s=o.$55l(3),H=E.add(s),n=new ii(H.x,H.y),i=new ii(c.x,c.y),B=new ii(G.y-$.y,$.x-G.x),A=G.x*$.y-$.x*G.y;for(var J=new sd(B.$60l(r),B.$60l(I),B.$60l(n),B.$60l(i)+A).$51l(),C=0;C<J.length;C++){var w=J[C];if(w>=0&&1>=w){var L=c.lerp(o,w),g=o.lerp(K,w),p=K.lerp(F,w),D=L.lerp(g,w),x=g.lerp(p,w),R=D.lerp(x,w);G.x==$.x?v.y<=R.y&&R.y<=N.y&&(t.$62l=l,t.$56l(R)):G.y==$.y?v.x<=R.x&&R.x<=N.x&&(t.$62l=l,t.$56l(R)):R.gte(v)&&R.lte(N)&&(t.$62l=l,t.$56l(R))}}return t},io=function(t,E,c,Q,v,M){var T=v.min(M),m=v.max(M),j=new hr(m.x,T.y),S=new hr(T.x,m.y),s=cj(t,E,c,Q,T,j),I=cj(t,E,c,Q,j,m),z=cj(t,E,c,Q,m,S),H=cj(t,E,c,Q,S,T),Y=new _g(Z);return Y.$57l(s.points),Y.$57l(I.points),Y.$57l(z.points),Y.$57l(H.points),Y.points.length>0&&(Y.$62l=l),Y},km=function(e,k,x,A){var y=x.min(A),g=x.max(A),z=new hr(g.x,y.y),Y=new hr(y.x,g.y),s=rs(y,z,e,k),a=rs(z,g,e,k),O=rs(g,Y,e,k),$=rs(Y,y,e,k),v=new _g(Z);return v.$57l(s.points),v.$57l(a.points),v.$57l(O.points),v.$57l($.points),v.points.length>0&&(v.$62l=l),v},Cq=k.XEditInteractor=function($){var q=this,w=q._view=document.createElement("canvas");w.className="editCanvas",w.style.position="absolute",Cq.superClass.constructor.call(q,$)};m.def(Cq,k.Interactor,{ms_edit:1,setUp:function(){var P=this,M=P.gv,T=M.getView(),x=P._view;Cq.superClass.setUp.call(P),M.setEditInteractor(P),M.$14l=x,M._79O?T.insertBefore(x,M._79O):T.appendChild(x);var m=P.$49l=P.$11l.bind(P);M.dm().md(m),M.sm().ms(m),M.mp(m)},tearDown:function(){var T=this,l=T.gv,D=l.getView(),P=T.$49l;Cq.superClass.tearDown.call(T),l.setEditInteractor(q),l.$14l=q,D.removeChild(T._view),l.dm().umd(P),l.sm().ums(P),l.ump(P)},clear:function(){var K=this,y=K.gv;delete K._hoverSegmentIndex,delete K._edge,delete K._shape,delete y._editing,delete K.$10l,delete K.$13l,delete K.$9l,delete K._removePointIndex,delete K._lp,K.$12l="",delete K.$40l,delete K.$67l,delete K.$72l,delete K.$73l,delete K.$75l,delete K.$1l,delete K.$3l,delete K.$2l,delete K.$92l,delete K.$93l,delete K.$94l,K.clearDragging()},handle_keydown:function(O){this.$48l!==O.shiftKey&&(this.$48l=O.shiftKey,this.handle_mousemove(O,T,!0))},handle_keyup:function(x){this.$48l!==x.shiftKey&&(this.$48l=x.shiftKey,this.handle_mousemove(x,T,!0))},handle_touchstart:function(h){this.handle_mousemove(h),this.handle_mousedown(h)},handle_mousedown:function(L){f(L);var I=this,E=I.$13l,C=I.gv,W=C.dm(),l=W.getHistoryManager(),P=C.sm(),d=C.getZoom(),g=C.lp(L),b=m.isDoubleClick(L),n=m.isLeftButton(L),R=I.$7l,h=I._shape,s=I._hoverSegmentIndex,Z=I._edge,y=I.$87l,Q=I.$88l,t=function(){I._68I||y===I.$87l&&Q===I.$88l||I.$43l()};if(7!==I.$67l&&(delete I.$87l,delete I.$88l),n&&(h||Z)&&s>=0&&b&&(h&&P.contains(h)||Z&&P.contains(Z))){var V=yc.call(I,h||Z,s,g);return I.addShapePoint(h||Z,s,V),z(function(){I.handle_mousemove(L)},40),void 0}if(n&&(h||Z)&&I._removePointIndex>=0&&b)return I.removeShapePoint(),I.$5l=1,z(function(){I.handle_mousemove(L)},40),void 0;if(!n||!C._editing)return t(),void 0;if(h&&E>=0){var r=h.getPoints().get(E),S=h.p(),x=qf(S,r.x-S.x,r.y-S.y,-R+h.getRotation());D=qf(S,g.x-S.x,g.y-S.y,-R),I.$24l={x:D.x-x.x,y:D.y-x.y},I.startDragging(L),l&&l.beginInteraction(),I.fi({kind:"beginEditPoint",event:L,data:h,index:E}),I.$88l=E,I.$87l=h}else if(I.$10l){var _=C.sm().getSelection(),v=I.$6l,B=I.$1l={},u=I.$3l={},k=I.$16l[i[I.$10l]],p={x:v.x,y:v.y},G={x:v.x+v.width/2,y:v.y+v.height/2};I.$24l={x:g.x-k.x/d,y:g.y-k.y/d},I.$2l=H(I.$8l),I.$4l=H(v),_.each(function(F){if(F instanceof J){var I=F.p(),h=F.getWidth(),w=F.getHeight(),t=qf(G,I.x-G.x,I.y-G.y,-R);B[F.getId()]={x:I.x-h/2,y:I.y-w/2,width:h,height:w},u[F.getId()]={x:(t.x-p.x)/v.width,y:(t.y-p.y)/v.height}}}),I.startDragging(L),l&&l.beginInteraction(),I.fi({kind:"beginEditRect",event:L,direction:I.$10l})}else if(Z&&E>=0){var O=xm(C.getDataUI(Z),Z.s("edge.points")),r=O.get(E);I.$24l={x:g.x-r.x,y:g.y-r.y},I.startDragging(L),l&&l.beginInteraction(),I.fi({kind:"beginEditPoint",event:L,data:Z,index:E}),I.$88l=E,I.$87l=Z}else if(I.$40l){var v=I.$6l,G={x:v.x+v.width/2,y:v.y+v.height/2},X=H(I.$23l);X.x/=d,X.y/=d;var Y=qf(G,X.x-G.x,X.y-G.y,-R),D=qf(G,g.x-G.x,g.y-G.y,-R);I.$24l={x:D.x-Y.x,y:D.y-Y.y},I.startDragging(L),l&&l.beginInteraction(),I.fi({kind:"beginEditRotation",event:L,data:I._rotationNode})}else if([1,2,3,5,6,7,8,9].indexOf(I.$67l)>=0){var T=I.$67l;(7===T||8===T||9===T)&&l&&l.beginInteraction(),I.startDragging(L)}else if(I.$71l&&b&&I.$79l(I.$71l,g)){var j=P.toSelection();l&&l.beginInteraction(),j.each(function(k){W.remove(k)}),l&&l.endInteraction()}t()},$11l:function(){var L=this,n=L.gv;n._editing&&(L.$13l==q||L._shape==q&&L._edge==q)&&(L.$73l==q||1!==L.$67l&&5!==L.$67l&&6!==L.$67l)||(L.$5l=1),L._68I=1},$46l:function(d){var A=this,Q=A.gv,K=Q.lp(d),T=[];return Kp(Q,function(S){var u=Q.getDataUI(S);if(u){var t=u._79o();W(t,K)&&T.push(S)}}),T},$47l:function(_){var I=this,q=I.$13l,t=I.gv.dm(),C=t.getHistoryManager();I.$10l?(I.fi({kind:"endEditRect",event:_,direction:I.$10l}),C&&C.endInteraction()):I._shape&&q>=0?(I.fi({kind:"endEditPoint",event:_,data:I._shape,index:q}),C&&C.endInteraction()):I._edge&&q>=0?(I.fi({kind:"endEditPoint",event:_,data:I._edge,index:q}),C&&C.endInteraction()):I.$23l&&I.$40l&&(I.fi({kind:"endEditRotation",event:_}),C&&C.endInteraction())},handleWindowTouchEnd:function(K){this.handleWindowMouseUp(K)},handleWindowMouseUp:function(v){var $=this,D=$.gv,K=D.dm(),s=K.getHistoryManager(),y=$._shape,U=$._edge,Y=$.$13l,j=$.$40l,G=$.$9l,I=$.$10l,F=$.$67l;if((y||U)&&Y>=0&&G>=0){var f,M;if(y){var h=y.p(),o=y.getRotation();f=y.getPoints(),M=f.get(G),Re(y,h,o,Y,M,!1)}else if(f=xm(D.getDataUI(U),U.s("edge.points"),!0),M=f.get(G),0===Y){var l=f.get(0);
U.s("edge.source.offset.x",M.x-l.x),U.s("edge.source.offset.y",M.y-l.y)}else if(Y===f.size()-1){var g=f.get(f.size()-1);U.s("edge.target.offset.x",M.x-g.x),U.s("edge.target.offset.y",M.y-g.y)}else"points"===U.s("edge.type")&&(f.set(Y,M),U.s("edge.points",wl(f)))}$.$47l(v);var H=$.$73l;1===F?(s&&s.beginInteraction(),H?D.sm().each(function(d){if(d.setHost&&D.isHelperEditable(d,"host")){d.setHost(H);var C=$.$75l,t=$.$74l;C&&(d.s("attach.row.index",C.rowIndex),d.s("attach.column.index",C.columnIndex)),t&&(d.s("attach.index",t.attachIndex),d.s("attach.offset",t.attachOffset),d.s("attach.offset.relative",!1),d.s("attach.offset.opposite",!1))}}):D.sm().each(function(S){S.setHost&&D.isHelperEditable(S,"host")&&(S.setHost(q),S.s("attach.row.index",T),S.s("attach.column.index",T),S.s("attach.index",T),S.s("attach.offset",T),S.s("attach.offset.relative",!1),S.s("attach.offset.opposite",!1))}),s&&s.endInteraction()):2===F?(s&&s.beginInteraction(),H?D.sm().each(function(i){i.setParent&&D.isHelperEditable(i,"parent")&&i.setParent(H)}):D.sm().each(function(u){u.setParent&&D.isHelperEditable(u,"parent")&&u.setParent(q)}),s&&s.endInteraction()):3===F?H&&(s&&s.beginInteraction(),D.sm().each(function(h){if(D.isHelperEditable(h,"edge")&&h instanceof J&&H instanceof J){var j=new L.Edge;K.add(j),j.setSource(h),j.setTarget(H),$.onEdgeCreated&&$.onEdgeCreated(v,j)}}),s&&s.endInteraction()):5===F||6===F?H&&(s&&s.beginInteraction(),D.sm().each(function(L){L instanceof _&&H instanceof J&&(5===F&&D.isHelperEditable(L,"source")?L.setSource(H):6===F&&D.isHelperEditable(L,"source")&&L.setTarget(H))}),s&&s.endInteraction()):(7===F||8===F||9===F)&&s&&s.endInteraction(),(I||j)&&$.$43l(!0),n?($.clear(),delete $.$64l,$._68I||$.$43l()):($.handle_mousemove(v,!0),F&&!$._68I&&$.$43l())},handleWindowTouchMove:function(y){this.handleWindowMouseMove(y)},handleWindowMouseMove:function(W){this._78I(W)},handle_mousemove:function(X,G,x){if(!this._pause){if(!x){var Y=n?Dh(X):X;this.$61l={clientX:Y.clientX,clientY:Y.clientY}}if(G===!0||!t()){var l=this,B=l.gv,Q=!1,P=q;l.clear(),B.sm().size()>0&&(P=B.lp(x?l.$61l:X),Q=l._79I(X,P)),Q&&(B._editing=1),l.$12l!==l.$65l&&(l.$65l=l.$12l,l.setCursor(l.$12l)),l.$40l!==l.$64l&&(l.$64l=l.$40l,l._68I||l.$43l()),l._hoverSegmentIndex!==l.$66l&&(l.$66l=l._hoverSegmentIndex,l._68I||l.$43l())}}},_78I:function(b){this.autoScroll(b);var G=this,S=G.gv,N=S.lp(b),V=S.getZoom(),k=G.$13l;if((G._shape||G._edge)&&k>=0){var $,O,H,a=G._shape,E=G._edge,o=G.$24l,D=S.getPointSnapSpacing(),i=function(u,o){return D==q||isNaN(D)?{x:u,y:o}:{x:Q(u/D)*D,y:Q(o/D)*D}};if(a){$=a.getPoints();var L=a.p(),g=a.getRotation(),h=0;O=qf(L,N.x-L.x,N.y-L.y,-g),Re(a,L,g,k,N,!0,o,i),G.fi({kind:"betweenEditPoint",event:b,data:a,index:k})}else if(E){$=xm(S.getDataUI(E),E.s("edge.points"),!0),N.x-=o.x,N.y-=o.y,O=N;var v,u,A=E.s("edge.offset"),j=$.size(),f=j>2;if(0===k){var Z=$.get(0);A&&(Z=po(Z,$.get(1),-A,f),N=po(N,$.get(1),-A,f)),v=N.x-Z.x,u=N.y-Z.y,H=i(v,u),E.s("edge.source.offset.x",H.x),E.s("edge.source.offset.y",H.y)}else if(k===j-1){var e=$.get(j-1);A&&(e=po(e,$.get(j-2),-A,f),N=po(N,$.get(j-2),-A,f)),v=N.x-e.x,u=N.y-e.y,H=i(v,u),E.s("edge.target.offset.x",H.x),E.s("edge.target.offset.y",H.y)}else"points"===E.s("edge.type")&&(H=i(N.x,N.y),H.e=$.get(k).e,$.set(k,H),E.s("edge.points",wl($)));G.fi({kind:"betweenEditPoint",event:b,data:E,index:k})}if(delete G.$9l,S.isSnapPoint(a)||S.isSnapPoint(E))for(h=0;h<$.size();h++)if(h!==k){var t=$.get(h);if(x(t,O)<S.getEditPointSize()/V){G.$9l=h;break}}}else if(G.$10l){var o=G.$24l;N.x-=o.x,N.y-=o.y;var r=S.sm().getSelection(),I=G.$1l,w=G.$7l,l=G.$10l,T=G.$4l,n=G.$2l,c=S.getEditRectPadding()/V,W=2*c,B=S.getSnapSpacing(),U=B!=q&&!isNaN(B),P=ih(n,N,l,w,2*c,S.getResizeMode(),U,!0),F=G.$6l;if(U){var K=P.width-W,y=P.height-W,X=Q(K/B)*B,js=Q(y/B)*B,mb=X-K,Xl=js-y;("west"===l||"northwest"===l||"southwest"===l)&&(mb=-mb),("north"===l||"northwest"===l||"northeast"===l)&&(Xl=-Xl),P=ih(n,N,l,w,2*c,S.getResizeMode(),U,!1,mb,Xl)}G.$8l=P,F.x=P.x+c,F.y=P.y+c,F.width=P.width-W,F.height=P.height-W;var bs=P.x+P.width/2,Zf=P.y+P.height/2,Hd=F.x,hq=F.y,ne=F.width/T.width,ye=F.height/T.height;r.each(function(D){if(D instanceof J&&S.isEditable(D)&&S.isRectEditable(D)){var Z=I[D.getId()],E=G.$3l[D.getId()],N={x:Z.x+Z.width/2,y:Z.y+Z.height/2},z=0,k=0,q=l,n=180*p(w-D.getRotation())/Y;"northeast"===l?n>=315||45>n?(z=Z.width*ne+Z.x,k=Z.height*(1-ye)+Z.y,q="northeast"):n>=45&&135>n?(z=Z.width*(1-ye)+Z.x,k=Z.height*(1-ne)+Z.y,q="northwest"):n>=135&&225>n?(z=Z.width*(1-ne)+Z.x,k=Z.height*ye+Z.y,q="southwest"):(z=Z.width*ye+Z.x,k=Z.height*ne+Z.y,q="southeast"):"north"===l?n>=315||45>n?(k=Z.height*(1-ye)+Z.y,q="north"):n>=45&&135>n?(z=Z.width*(1-ye)+Z.x,q="west"):n>=135&&225>n?(k=Z.height*ye+Z.y,q="south"):(z=Z.width*ye+Z.x,q="east"):"northwest"===l?n>=315||45>n?(z=Z.width*(1-ne)+Z.x,k=Z.height*(1-ye)+Z.y,q="northwest"):n>=45&&135>n?(z=Z.width*(1-ye)+Z.x,k=Z.height*ne+Z.y,q="southwest"):n>=135&&225>n?(z=Z.width*ne+Z.x,k=Z.height*ye+Z.y,q="southeast"):(z=Z.width*ye+Z.x,k=Z.height*(1-ne)+Z.y,q="northeast"):"west"===l?n>=315||45>n?(z=Z.width*(1-ne)+Z.x,q="west"):n>=45&&135>n?(k=Z.height*ne+Z.y,q="south"):n>=135&&225>n?(z=Z.width*ne+Z.x,q="east"):(k=Z.height*(1-ne)+Z.y,q="north"):"southwest"===l?n>=315||45>n?(z=Z.width*(1-ne)+Z.x,k=Z.height*ye+Z.y,q="southwest"):n>=45&&135>n?(z=Z.width*ye+Z.x,k=Z.height*ne+Z.y,q="southeast"):n>=135&&225>n?(z=Z.width*ne+Z.x,k=Z.height*(1-ye)+Z.y,q="northeast"):(z=Z.width*(1-ye)+Z.x,k=Z.height*(1-ne)+Z.y,q="northwest"):"east"===l?n>=315||45>n?(z=Z.width*ne+Z.x,q="east"):n>=45&&135>n?(k=Z.height*(1-ne)+Z.y,q="north"):n>=135&&225>n?(z=Z.width*(1-ne)+Z.x,q="west"):(k=Z.height*ne+Z.y,q="south"):"south"===l?n>=315||45>n?(k=Z.height*ye+Z.y,q="south"):n>=45&&135>n?(z=Z.width*ye+Z.x,q="east"):n>=135&&225>n?(k=Z.height*(1-ye)+Z.y,q="north"):(z=Z.width*(1-ye)+Z.x,q="west"):"southeast"===l&&(n>=315||45>n?(z=Z.width*ne+Z.x,k=Z.height*ye+Z.y,q="southeast"):n>=45&&135>n?(z=Z.width*ye+Z.x,k=Z.height*(1-ne)+Z.y,q="northeast"):n>=135&&225>n?(z=Z.width*(1-ne)+Z.x,k=Z.height*(1-ye)+Z.y,q="northwest"):(z=Z.width*(1-ye)+Z.x,k=Z.height*ne+Z.y,q="southwest"));var P=qf(N,z-N.x,k-N.y,D.getRotation());gr(D,Z,q,{x:P.x,y:P.y});var L=Hd+F.width*E.x,R=hq+F.height*E.y,O={x:L,y:R};O=qf({x:bs,y:Zf},O.x-bs,O.y-Zf,w),D.p(O.x,O.y)}}),G.fi({kind:"betweenEditRect",event:b,direction:l})}else if(G.$23l&&G.$40l){var Jo=G.$8l,Yi=Jo.width,yj=Jo.height,L={x:Jo.x+Yi/2,y:Jo.y+yj/2},o=G.$24l,wi=G.$23l,mq=wi.x/V-L.x,Tn=wi.y/V-L.y,xl=M(mq*mq+Tn*Tn),ci=Math.asin(o.x/xl),Tr=S.sm().getSelection(),ml=s+d(N.y-L.y,N.x-L.x)-ci,zq=S.getSnapAngle(),ml=Q(ml/zq)*zq;0>ml&&(ml+=C);var lg=ml-G.$7l,vg=[L.x,0,L.y];Tr.each(function(B){if(S.isEditable(B)&&S.isRotationEditable(B)&&S.isVisible(B)){var X=ks(B.p3(),vg),A=Jg();mh(A,-lg),B.setRotation(B.getRotation()+lg),Ef(X,A),B.p3(vg[0]+X[0],vg[1]+X[1],vg[2]+X[2])}}),G.$7l=ml,G.fi({kind:"betweenEditRotation",event:b})}else if([1,2,3,5,6].indexOf(G.$67l)>=0)G.$72l=b,G.$78l||(G.$78l=1,z(function(){m.isDragging()&&G.$43l(),delete G.$78l},12));else if(7===G.$67l){if(G.$87l instanceof R){var a=G.$87l,Ed=G.$88l,rs=m.clone(a.getPoints().get(Ed)),Ji=N.y-rs.y;rs.e||(rs.e=0),G.$92l||(G.$92l=rs.e),rs.e=G.$92l-Ji,a.setPoint(Ed,rs)}else if(G.$87l instanceof _){var E=G.$87l,Ed=G.$88l,$=xm(S.getDataUI(E),E.s("edge.points")),rs=$.get(Ed),Ji=N.y-rs.y;rs.e||(rs.e=0),G.$92l||(G.$92l=rs.e),rs.e=G.$92l-Ji,$.set(Ed,rs),E.s("edge.points",wl($))}}else if(8===G.$67l){var Tr=S.sm().getSelection(),qn=G.$93l;qn||(qn=G.$93l={}),Tr.each(function(P){if(P.p3){var d=P.p3(),I=qn[P.getId()];I==q&&(I=qn[P.getId()]=d[1]),P.p3([d[0],I-(N.y-G.$90l.y/V),d[2]])}})}else if(9===G.$67l){var Tr=S.sm().getSelection(),vj=G.$94l;vj||(vj=G.$94l={}),Tr.each(function(h){if(h.s3){var v=h.s3(),k=vj[h.getId()];k==q&&(k=vj[h.getId()]=v[1]);var M=k-(N.y-G.$91l.y/V);0>M&&(M=.01),h.s3([v[0],M,v[2]])}})}},$79l:function(Y,N){var m=this,j=m.gv,H=j.getZoom(),B=j.getEditHelperSize(),D=Y.x/H,F=Y.y/H,S=B/H,Z=S/2;return W({x:D-Z,y:F-Z,width:S,height:S},N)?!0:void 0},getHelperCursor:function(){return"crosshair"},_79I:function(t,f){for(var J=this,g=J.gv,h=g.getZoom(),o=g.getEditPointSize(),E=o/h,C=E/2,p=J.$46l(t),N=0;N<p.length;N++){var i,V,X=p[N],B=g.getDataUI(X);if(B&&B._55O){var Q=B._55O;if(Q._43O&&X instanceof _){if(i=X.s("edge.points"),i=xm(B,i),V=X.s("edge.segments"),V&&V.size()||(V=fh(i)),J.$42l(X,f,i._as,V,"edge"))return!0;if("points"===X.s("edge.type"))return J.$41l(X,f,i._as,V,"edge"),void 0}if(Q._43O&&X instanceof R&&Q.$15l&&Q.$15l.length===X.getPoints().size()){if(i=Q.$15l,V=X.getSegments(),V&&V.size()||(V=fh(i)),J.$42l(X,f,i,V,"shape"))return!0;if(J.$41l(X,f,i,V,"shape"))return}}}if(J.$16l){var i,v=J.$16l,l=v[3].x-v[7].x,A=v[3].y-v[7].y,d=M(l*l+A*A),y=v[1].x-v[5].x,K=v[1].y-v[5].y,I=M(y*y+K*K),u={x:f.x*h,y:f.y*h};if(J._80I(u,0,v[0],"northwest",d,I)||J._80I(u,1,v[1],"north",d,I)||J._80I(u,2,v[2],"northeast",d,I)||J._80I(u,7,v[7],"west",d,I)||J._80I(u,3,v[3],"east",d,I)||J._80I(u,6,v[6],"southwest",d,I)||J._80I(u,5,v[5],"south",d,I)||J._80I(u,4,v[4],"southeast",d,I))return!0}if(J.$23l){var Z=J.$23l,x=Z.x/h,s=Z.y/h;if(W({x:x-C,y:s-C,width:E,height:E},f))return J.$40l=1,J.$12l=J.getHelperCursor("rotation")||"crosshair",!0}return J.$68l&&J.$79l(J.$68l,f)?(J.$67l=1,J.$12l=J.getHelperCursor("host")||"crosshair",!0):J.$69l&&J.$79l(J.$69l,f)?(J.$67l=2,J.$12l=J.getHelperCursor("parent")||"crosshair",!0):J.$70l&&J.$79l(J.$70l,f)?(J.$67l=3,J.$12l=J.getHelperCursor("edge")||"crosshair",!0):J.$71l&&J.$79l(J.$71l,f)?(J.$67l=4,J.$12l=J.getHelperCursor("remove")||"crosshair",!0):J.$82l&&J.$79l(J.$82l,f)?(J.$67l=5,J.$12l=J.getHelperCursor("source")||"crosshair",!0):J.$83l&&J.$79l(J.$83l,f)?(J.$67l=6,J.$12l=J.getHelperCursor("target")||"crosshair",!0):J._pointElevationHelperPoint&&J.$79l(J._pointElevationHelperPoint,f)?(J.$67l=7,J.$12l=J.getHelperCursor("pointElevation")||"crosshair",!0):J.$90l&&J.$79l(J.$90l,f)?(J.$67l=8,J.$12l=J.getHelperCursor("elevation")||"crosshair",!0):J.$91l&&J.$79l(J.$91l,f)?(J.$67l=9,J.$12l=J.getHelperCursor("tall")||"crosshair",!0):!1},_80I:function(A,_,w,G,r,v){var y=this,o=y.gv,M=o.getEditPointSize(),d=M/2,C=o.sm(),f=o.isDirectionEditable;if(f&&1===C.size()){var B=C.ld();if(f=f.bind(o),B instanceof J){if(!f(B,G))return!1;if("east"===G){if(f(B,"northeast")&&f(B,"southeast")&&2*M>=v)return!1}else if("west"===G){if(f(B,"northwest")&&f(B,"southwest")&&2*M>=v)return!1}else if("north"===G){if(f(B,"northwest")&&f(B,"northeast")&&2*M>=r)return!1}else if("south"===G&&f(B,"southwest")&&f(B,"southeast")&&2*M>=r)return!1}}else{if(2*M>=r&&("north"===G||"south"===G))return!1;if(2*M>=v&&("east"===G||"west"===G))return!1}if(W({x:w.x-d,y:w.y-d,width:M,height:M},A)){if(y.$10l!==G){var b=180*y.$7l/Y,p="";b>=337.5||22.5>b?p="north":b>=22.5&&67.5>b?p="northeast":b>=67.5&&112.5>b?p="east":b>=112.5&&157.5>b?p="southeast":b>=157.5&&202.5>b?p="south":b>=202.5&&247.5>b?p="southwest":b>=247.5&&292.5>b?p="west":b>=292.5&&337.5>b&&(p="northwest");var T=$b.indexOf(p),p=$b[_-(1-T)+8];switch(p){case"northwest":y.$12l="nwse-resize";break;case"northeast":y.$12l="nesw-resize";break;case"southwest":y.$12l="nesw-resize";break;case"southeast":y.$12l="nwse-resize";break;case"north":y.$12l="ns-resize";break;case"east":y.$12l="ew-resize";break;case"south":y.$12l="ns-resize";break;case"west":y.$12l="ew-resize"}y.$10l=G}return!0}return!1},$42l:function(T,J,N,b,Y){var z,c=this,s=c.gv,E=s.getEditPointSize(),K=E/s.getZoom(),j=-1,p={x:J.x,y:J.y,width:0,height:0},v=function(M){"shape"===Y?c._shape=T:c._edge=T,c._removePointIndex=M},m=function(p){"shape"===Y?c._shape=T:c._edge=T,c.$13l=p,c.$12l="crosshair"};for(y(p,K/2),j=N.length-1,z=b.size()-1;z>=0;z--){var l=b.get(z);if(1===l||2===l)j-=1;else if(3===l){var n=N[j-1];if(W(p,n))return m(j-1),!0;j-=2}else if(4===l){var I=N[j-1],$=N[j-2];if(W(p,I))return m(j-1),!0;if(W(p,$))return m(j-2),!0;j-=3}}for(j=N.length-1,z=b.size()-1;z>=0;z--){var l=b.get(z),Q=N[j];if(W(p,Q))return v(j),m(j),!0;1===l||2===l?j-=1:3===l?j-=2:4===l&&(j-=3)}return!1},$41l:function(T,i,u,b,F){var p=this,K=p.gv,f=-1,e=0,J={x:i.x,y:i.y,width:0,height:0},Y=function(D,o){p._hoverSegmentIndex=o,p._lp=i,"shape"===F?p._shape=T:p._edge=T};for(y(J,K.getSegmentHoverWidth()/2/K.getZoom()),T instanceof R&&T.isClosePath()&&b.indexOf(5)<0&&(b=new D(b._as),b.add(5));e<b.size();e++){var t=b.get(e);if(1===t){var w=u[f],O=u[f+1];if(w){var M=km(new hr(w.x,w.y),new hr(O.x,O.y),new hr(J.x,J.y),new hr(J.x+J.width,J.y+J.height));if(M.$62l===l&&M.points.length>0)return Y(M,e),!0}f+=1}else if(2===t){var w=u[f],O=u[f+1],M=km(new hr(w.x,w.y),new hr(O.x,O.y),new hr(J.x,J.y),new hr(J.x+J.width,J.y+J.height));if(M.$62l===l&&M.points.length>0)return Y(M,e),!0;f+=1}else if(3===t){var w=u[f],j=u[f+1],X=u[f+2],M=Up(new hr(w.x,w.y),new hr(j.x,j.y),new hr(X.x,X.y),new hr(J.x,J.y),new hr(J.x+J.width,J.y+J.height));if(M.$62l===l)return Y(M,e),!0;f+=2}else if(4===t){var w=u[f],B=u[f+1],H=u[f+2],X=u[f+3],M=io(new hr(w.x,w.y),new hr(B.x,B.y),new hr(H.x,H.y),new hr(X.x,X.y),new hr(J.x,J.y),new hr(J.x+J.width,J.y+J.height));if(M.$62l===l)return Y(M,e),!0;f+=3}else if(5===t){var w=u[f],O=u[0];if(w){var M=km(new hr(w.x,w.y),new hr(O.x,O.y),new hr(J.x,J.y),new hr(J.x+J.width,J.y+J.height));if(M.$62l===l&&M.points.length>0)return Y(M,e),!0}}}return!1},addShapePoint:function(V,z,I){var x=this,T=x.gv,Z=T.dm(),f=Z.getHistoryManager();if(f&&f.beginInteraction(),0===arguments.length&&(V=x._shape||x._edge,z=x._hoverSegmentIndex,I=x._lp),V instanceof R||V instanceof _){var v=Qc(V,T.getDataUI(V),z);if(!isNaN(z)&&I&&!isNaN(v)){var g=I;if(V instanceof R){var F=V.p(),L=V.getRotation(),U=V.toSegments();U&&U.size()||(U=fh(V.getPoints())),V.isClosePath()&&U.indexOf(5)<0&&(U=new D(U._as),U.add(5));var Y=U.get(z),G="addPoint",d="removePointAt";if(2===Y||1===Y){var N={x:g.x,y:g.y};U.add(Y,z),N=qf(F,N.x-F.x,N.y-F.y,-L),V[G](N,v+1)}else if(3===Y){var W=V.getPoints(),Q=W.get(v),P=W.get(v+2),N={x:g.x,y:g.y};N=qf(F,N.x-F.x,N.y-F.y,-L);var K=vs(Q,N),k=vs(N,P);U.removeAt(z),U.add(3,z),U.add(3,z),V.setPoint(v+1,N),V[G](k,v+2),V[G](K,v+1)}else if(4===Y){var W=V.getPoints(),Q=W.get(v),P=W.get(v+3),N={x:g.x,y:g.y};N=qf(F,N.x-F.x,N.y-F.y,-L);var K=rd(Q,N),k=El(Q,N),l=rd(N,P),A=El(N,P);U.removeAt(z),U.add(4,z),U.add(4,z),V[d](v+1),V[d](v+1),V[G](N,v+1),V[G](A,v+2),V[G](l,v+2),V[G](k,v+1),V[G](K,v+1)}else if(5===Y){var N={x:g.x,y:g.y};U.add(2,z),N=qf(F,N.x-F.x,N.y-F.y,-L),V[G](N,v+1)}V.isClosePath()&&U.remove(5),V.setSegments(U);var H=V.getWidth(),$=V.getHeight(),i=V.p().x-H/2,q=V.p().y-$/2;i-=F.x,q-=F.y;var C=_p(V,{x:i,y:q,width:H,height:$},L,F);V.p(C.x,C.y)}else if(V instanceof _){if("points"!==V.s("edge.type"))return f&&f.endInteraction(),void 0;var W=V.s("edge.points");U=V.s("edge.segments"),W=xm(T.getDataUI(V),W),U&&U.size()||(U=fh(W)),U=new D(U._as.slice(0)),W=new D(W._as.slice(0));var Y=U.get(z);if(2===Y||1===Y){var N={x:g.x,y:g.y};U.add(Y,z),W.add(N,v+1)}else if(3===Y){var Q=W.get(v),P=W.get(v+2),N={x:g.x,y:g.y},K=vs(Q,N),k=vs(N,P);U.removeAt(z),U.add(3,z),U.add(3,z),W.set(v+1,N),W.add(k,v+2),W.add(K,v+1)}else if(4===Y){var Q=W.get(v),P=W.get(v+3),N={x:g.x,y:g.y},K=rd(Q,N),k=El(Q,N),l=rd(N,P),A=El(N,P);U.removeAt(z),U.add(4,z),U.add(4,z),W.removeAt(v+1),W.removeAt(v+1),W.add(N,v+1),W.add(A,v+2),W.add(l,v+2),W.add(k,v+1),W.add(K,v+1)}V.s("edge.points",wl(W)),V.s("edge.segments",U)}}}f&&f.endInteraction()},removeShapePoint:function(J,I){var L=this,B="removeAt",d=L.gv,P=d.dm(),M=P.getHistoryManager();if(M&&M.beginInteraction(),0===arguments.length&&(J=L._shape||L._edge,I=L._removePointIndex),I>=0&&(J instanceof R||J instanceof _)){var E=Lg(J,L.gv.getDataUI(J),I),j=I;if(J instanceof R){var F=J.p(),o=J.toSegments();o&&o.size()||(o=fh(J.getPoints()));var t=o.get(E),V="removePointAt";if(1===t&&0===j)if(J.getPoints().size()>1){var m=o.get(E+1);o[B](E+1),3===m?J[V](j+1):4===m&&(J[V](j+2),J[V](j+1)),J[V](j)}else J.dm().remove(J);else 2===t||1===t?(o[B](E),J[V](j)):3===t?(o[B](E),J[V](j),J[V](j-1)):4===t&&(o[B](E),J[V](j),J[V](j-1),J[V](j-2));J.setSegments(o);var x=J.getWidth(),p=J.getHeight(),U=J.p().x-x/2,Y=J.p().y-p/2;U-=F.x,Y-=F.y;var c=_p(J,{x:U,y:Y,width:x,height:p},J.getRotation(),F);J.p(c.x,c.y)}else if(J instanceof _){if("points"!==J.s("edge.type"))return M&&M.endInteraction(),void 0;var z=J.s("edge.points");if(o=J.s("edge.segments"),z&&(z=xm(L.gv.getDataUI(J),z),o&&o.size()||(o=fh(z))),0===I||I===z.size()-1)return M&&M.endInteraction(),void 0;o=new D(o._as.slice(0)),z=new D(z._as.slice(0));var t=o.get(E);2===t||1===t?(o[B](E),z[B](j)):3===t?(o[B](E),z[B](j),z[B](j-1)):4===t&&(o[B](E),z[B](j),z[B](j-1),z[B](j-2)),J.s("edge.segments",o),J.s("edge.points",wl(z))}}M&&M.endInteraction()},changeShapeSegment:function(j,L,V){var G=this,E=G.gv,q=E.dm(),y=q.getHistoryManager();if(y&&y.beginInteraction(),1!==arguments.length||isNaN(j)||(V=j,j=G._shape||G._edge,L=G._hoverSegmentIndex),j instanceof R||j instanceof _){var H=Qc(j,G.gv.getDataUI(j),L);if(!isNaN(L)&&!isNaN(H))if(j instanceof R){var w=j.p(),$=j.toSegments();$&&$.size()||($=fh(j.getPoints()));var d=$.get(L),k=j.toPoints();if(1===V||2===V)1===d||2===d?$.set(L,V):3===d?($.set(L,V),k.removeAt(H+1)):4===d&&($.set(L,V),k.removeAt(H+1),k.removeAt(H+1));else if(3===V){var g=function(){var I=k.get(H),b=k.get(H+1),U=vs(I,b);$.set(L,3),k.add(U,H+1)};2===d||1===d?g():4===d&&(k.removeAt(H+1),k.removeAt(H+1),g())}else if(4===V){var x=function(){var n=k.get(H),t=k.get(H+1),F=rd(n,t),v=El(n,t);$.set(L,4),k.add(F,H+1),k.add(v,H+2)};2===d||1===d?x():3===d&&(k.removeAt(H+1),x())}j.setSegments($),j.setPoints(k);var c=j.getWidth(),l=j.getHeight(),n=j.p().x-c/2,J=j.p().y-l/2;n-=w.x,J-=w.y;var O=new _p(j,{x:n,y:J,width:c,height:l},j.getRotation(),w);j.p(O.x,O.y)}else if(j instanceof _){if("points"!==j.s("edge.type"))return y&&y.endInteraction(),void 0;var k=j.s("edge.points");$=j.s("edge.segments"),k&&(k=xm(G.gv.getDataUI(j),k),$&&$.size()||($=fh(k))),$=new D($._as.slice(0)),k=new D(k._as.slice(0));var d=$.get(L);if(1===V||2===V)1===d||2===d?$.set(L,V):3===d?($.set(L,V),k.removeAt(H+1)):4===d&&($.set(L,V),k.removeAt(H+1),k.removeAt(H+1));else if(3===V){var g=function(){var g=k.get(H),r=k.get(H+1),M=vs(g,r);$.set(L,3),k.add(M,H+1)};2===d||1===d?g():4===d&&(k.removeAt(H+1),k.removeAt(H+1),g())}else if(4===V){var x=function(){var Q=k.get(H),d=k.get(H+1),J=rd(Q,d),e=El(Q,d);$.set(L,4),k.add(J,H+1),k.add(e,H+2)};2===d||1===d?x():3===d&&(k.removeAt(H+1),x())}j.s("edge.points",wl(k)),j.s("edge.segments",$)}}y&&y.endInteraction()},getDefaultSegments:function(b){var $=this.gv,p=$.getDataUI(b);if(b instanceof _){var T=b.s("edge.points");return T=xm(p,T),fh(T)}if(b instanceof R){var T=b.getPoints(),C=b.getSegments();return C&&C.size()>0?C:fh(T)}},$43l:function(h){var F=this;h&&(F.$5l=1),F._68I=1,F._42()},_42:function(){var Z=this;if(Z._68I){delete Z._68I;var i=Z.gv,v=Z.$5l,a=i.getZoom(),K=i.getEditPointSize(),h=K/2,u=new D,Q=Z._view,c=Z._edge,x=Z._shape,V=Q.getContext("2d"),S=i.tx(),s=i.ty(),j=q,f=i.getEditPointBackground(),r=i.getControlPointBackground(),Y=i.getControlPointBorderColor(),e=i.getEditPointBorderColor(),l=i.getEditRectBorderColor(),$=i.getDirectionLineColor(),W=i.getSegmentHoverColor(),E=i.getSnapPointBorderColor(),n=i.getJoinPointBackground(),T=i.getJoinPointBorderColor(),g=i.getSegmentHoverWidth(),z=[5,5],k=i.getEditRectBorderStyle();og(i,function(Y){i.isSelected(Y)&&i.isVisible(Y)&&u.add(Y)}),V.clearRect(0,0,P(Q.width),P(Q.height)),V.save(),B.translateAndScale(V,S,s,1);var I=q,A={x:0,y:0,width:0,height:0},F=0,w=0,t=0,X=0,p=0,d=0,Kd=0,Nj=0,Ag=0,Mi=0,Rr=[];if(v?(delete Z.$6l,delete Z.$8l,delete Z.$7l,delete Z.$16l,delete Z.$23l):(I=Z.$6l,j=Z.$7l),delete Z.$68l,delete Z.$69l,delete Z.$71l,delete Z.$70l,delete Z.$82l,delete Z.$83l,delete Z._pointElevationHelperPoint,delete Z.$90l,delete Z.$91l,delete Z.$75l,delete Z.$74l,u.each(function(D){var Z=i.getDataUI(D);if(Z){var H=Z._55O;if(i.isEditable(D))H._56O&&D instanceof J&&w++,Rr.push(D),H._42O&&D instanceof J&&F++,i.isHelperEditable(D,"host")&&X++,i.isHelperEditable(D,"parent")&&t++,i.isHelperEditable(D,"remove")&&p++,i.isHelperEditable(D,"edge")&&d++,i.isHelperEditable(D,"source")&&Kd++,i.isHelperEditable(D,"target")&&Nj++,i.isHelperEditable(D,"elevation")&&Ag++,i.isHelperEditable(D,"tall")&&Mi++;else if(D instanceof U&&D.isExpanded()){var e=!0,j=i.getEditableFunc();j&&(e=j(D)),e&&(i.isHelperEditable(D,"host")&&X++,i.isHelperEditable(D,"parent")&&t++,i.isHelperEditable(D,"remove")&&p++,i.isHelperEditable(D,"edge")&&d++,i.isHelperEditable(D,"source")&&Kd++,i.isHelperEditable(D,"target")&&Nj++,i.isHelperEditable(D,"elevation")&&Ag++,i.isHelperEditable(D,"tall")&&Mi++,Rr.push(D))}}}),V.beginPath(),V.lineWidth=1,V.strokeStyle=i.getNodeBorderColor(),Rr.forEach(function(K){var R=i.getDataUI(K),o=R._55O;if(v)if(j==q&&(j=K instanceof _?0:K instanceof U&&K.isExpanded()?0:K.getRotation(),Z.$7l=j),I==q){var b,l,k;if(K instanceof U&&K.isExpanded()||K instanceof _){var g=i.getDataUIBounds(K);l=g.width,k=g.height,b={x:g.x+l/2,y:g.y+k/2}}else b=K.p(),l=K.getWidth(),k=K.getHeight();I={x:b.x,y:b.y,width:0,height:0},A.x=b.x-l/2,A.y=b.y-k/2,A.width=l,A.height=k,I=N(I,A)}else{var b,l,k,$,p=I.x+I.width/2,B=I.y+I.height/2,C={x:p,y:B};if(K instanceof U&&K.isExpanded()||K instanceof _){$=0;var g=i.getDataUIBounds(K);l=g.width,k=g.height,b={x:g.x+l/2,y:g.y+k/2}}else b=K.p(),l=K.getWidth(),k=K.getHeight(),$=K.getRotation();var m={x:b.x-l/2,y:b.y-k/2,width:l,height:k},n={x:m.x,y:m.y},P={x:m.x+m.width,y:m.y},r={x:m.x,y:m.y+m.height},S={x:m.x+m.width,y:m.y+m.height},n=qf(b,n.x-b.x,n.y-b.y,$),r=qf(b,r.x-b.x,r.y-b.y,$),S=qf(b,S.x-b.x,S.y-b.y,$),P=qf(b,P.x-b.x,P.y-b.y,$),d=-j,y=qf(C,n.x-C.x,n.y-C.y,d),T=qf(C,P.x-C.x,P.y-C.y,d),e=qf(C,r.x-C.x,r.y-C.y,d),s=qf(C,S.x-C.x,S.y-C.y,d),M=O([y,T,e,s]);I=N(I,M),I.x-=p,I.y-=B;var W=_p(q,I,j,C);I.x=W.x-I.width/2,I.y=W.y-I.height/2}if(F>1&&i.isEditable(K)&&i.isRectEditable(K)&&K instanceof J){var L=K.getRect(),G=o.$45l,h=wo(G[0],a),w=wo(G[2],a),H=wo(G[4],a),u=wo(G[6],a);K.getRotation()?(V.moveTo(h.x,h.y),V.lineTo(w.x,w.y),V.lineTo(H.x,H.y),V.lineTo(u.x,u.y),V.lineTo(h.x,h.y)):V.rect(L.x*a,L.y*a,L.width*a,L.height*a)}}),V.stroke(),I){Z.$6l=H(I),y(I,i.getEditRectPadding()/a);var se={x:I.x+I.width/2,y:I.y+I.height/2},xe=lf(se,I.width,I.height,j),zn=xe[0],We=xe[1],gm=xe[2],zr=xe[3],Sd=xe[4],si=xe[5],Nl=xe[6],so=xe[7];if(zn=wo(xe[0],a),We=wo(xe[1],a),gm=wo(xe[2],a),zr=wo(xe[3],a),Sd=wo(xe[4],a),si=wo(xe[5],a),Nl=wo(xe[6],a),so=wo(xe[7],a),Z.$8l=I,F>0&&(Z.$16l=[zn,Sd,We,si,zr,Nl,gm,so],V.beginPath(),V.lineWidth=1,V.strokeStyle=l,"dashed"===k&&V.setLineDash&&V.setLineDash(z),V.moveTo(zn.x,zn.y),V.lineTo(We.x,We.y),V.lineTo(zr.x,zr.y),V.lineTo(gm.x,gm.y),V.lineTo(zn.x,zn.y),V.stroke(),"dashed"===k&&V.setLineDash&&V.setLineDash([])),V.beginPath(),V.lineWidth=1,V.fillStyle=f,V.strokeStyle=e,F>0){var um=si.x-so.x,Nf=si.y-so.y,Pb=M(um*um+Nf*Nf),hi=Sd.x-Nl.x,vq=Sd.y-Nl.y,lg=M(hi*hi+vq*vq),lb=2*K;if(i.isDirectionEditable&&1===Rr.length){var zo=Rr[0],Xk=i.getDataUI(zo),Dm=Xk._55O,ik=i.isDirectionEditable.bind(i);if(Dm._42O){var Bf,ze,Nq,Xj;ik(zo,"northwest")&&(Bf=!0,V.rect(zn.x-h,zn.y-h,K,K)),ik(zo,"northeast")&&(ze=!0,V.rect(We.x-h,We.y-h,K,K)),ik(zo,"southwest")&&(Nq=!0,V.rect(gm.x-h,gm.y-h,K,K)),ik(zo,"southeast")&&(Xj=!0,V.rect(zr.x-h,zr.y-h,K,K)),ik(zo,"north")&&(Bf&&ze?Pb>lb&&V.rect(Sd.x-h,Sd.y-h,K,K):V.rect(Sd.x-h,Sd.y-h,K,K)),ik(zo,"south")&&(Xj&&Nq?Pb>lb&&V.rect(Nl.x-h,Nl.y-h,K,K):V.rect(Nl.x-h,Nl.y-h,K,K)),ik(zo,"west")&&(Nq&&Bf?lg>lb&&V.rect(so.x-h,so.y-h,K,K):V.rect(so.x-h,so.y-h,K,K)),ik(zo,"east")&&(Xj&&ze?lg>lb&&V.rect(si.x-h,si.y-h,K,K):V.rect(si.x-h,si.y-h,K,K))}}else Pb>lb&&(V.rect(Sd.x-h,Sd.y-h,K,K),V.rect(Nl.x-h,Nl.y-h,K,K)),lg>lb&&(V.rect(si.x-h,si.y-h,K,K),V.rect(so.x-h,so.y-h,K,K)),V.rect(zn.x-h,zn.y-h,K,K),V.rect(We.x-h,We.y-h,K,K),V.rect(gm.x-h,gm.y-h,K,K),V.rect(zr.x-h,zr.y-h,K,K)}if(w>0){var wf=Z.$23l=qf(Sd,0,2*-K,j);V.moveTo(wf.x+h,wf.y),V.arc(wf.x,wf.y,h,0,C,!1)}V.fill(),V.stroke(),Z.$40l&&Z.$44l(V,I,j);var Ah,Zi,Ck=i.getLeftTopHelpers(),xg=i.getRightTopHelpers(),Bg=i.getLeftBottomHelpers(),Hd=i.getRightBottomHelpers(),te=i.getEdgeHelpers(),pl=i.getEditHelperSize(),lq=pl/2,Ao=function(w,Y,$,G){"leftTop"===Y?(Ah=I.x*a-pl-h-("h"===G?$*(pl+h):0)-1,Zi=I.y*a-pl-h-("v"===G?$*(pl+h):0)-1):"rightTop"===Y?(Ah=(I.x+I.width)*a+h+("h"===G?$*(pl+h):0)+1,Zi=I.y*a-pl-h-("v"===G?$*(pl+h):0)-1):"leftBottom"===Y?(Ah=I.x*a-pl-h-("h"===G?$*(pl+h):0)-1,Zi=(I.y+I.height)*a+h+("v"===G?$*(pl+h):0)+1):"rightBottom"===Y&&(Ah=(I.x+I.width)*a+h+("h"===G?$*(pl+h):0)+1,Zi=(I.y+I.height)*a+h+("v"===G?$*(pl+h):0)+1);var A=Ah+lq,K=Zi+lq,b=(I.x+I.width/2)*a,f=(I.y+I.height/2)*a,E=qf({x:b,y:f},A-b,K-f,j);if("host"===w){if(X>0)return Z.$77l(V,j,E),!0}else if("edge"===w){if(d>0)return Z.$80l(V,j,E),!0}else if("remove"===w){if(p>0)return Rr&&1===Rr.length&&Rr[0]instanceof _?Z.$81l(V,j,{x:b+pl/2+5,y:f}):Z.$81l(V,j,E),!0}else if("parent"===w){if(t>0)return Rr&&1===Rr.length&&Rr[0]instanceof _?Z.$76l(V,j,{x:b-pl/2-5,y:f}):Z.$76l(V,j,E),!0}else if("elevation"===w){if(Ag>0)return Z.$85l(V,j,E),!0}else if("tall"===w){if(Mi>0)return Z.$86l(V,j,E),!0}else if("source"===w||"target"===w){var J=Rr[0],W=i.getDataUI(J),q=np(W,!0),s=q[0],F=q[1];if(Kd&&"source"===w)return Z.$84l(V,I,s,!0,J.isLooped(),Y,$,G),!0;if(Nj&&"target"===w)return Z.$84l(V,I,F,!1,J.isLooped(),Y,$,G),!0}};if(Ck&&Ck.length>0){var Tf=0;Ck.forEach(function(x){Ao(x,"leftTop",Tf,i.getLeftTopHelpersAlign()||"h")&&Tf++})}if(xg&&xg.length>0){var Tf=0;xg.forEach(function(u){Ao(u,"rightTop",Tf,i.getRightTopHelpersAlign()||"h")&&Tf++})}if(Bg&&Bg.length>0){var Tf=0;Bg.forEach(function(Q){Ao(Q,"leftBottom",Tf,i.getLeftBottomHelpersAlign()||"h")&&Tf++})}if(Hd&&Hd.length>0){var Tf=0;Hd.forEach(function(b){Ao(b,"rightBottom",Tf,i.getRightBottomHelpersAlign()||"h")&&Tf++})}if(te&&te.length>0&&((Kd||Nj)&&Rr&&1===Rr.length&&Rr[0]instanceof _?!0:!1)){var Tf=0;te.forEach(function(k){Ao(k,"edge",Tf,"h")&&Tf++})}if(Z.$72l){var Lj,lo=Z.$67l,mr=Z.$68l,Ve=Z.$69l,Il=(Z.$71l,Z.$70l),_i=Z.$82l,Oh=Z.$83l;if(1===lo?Lj=mr:2===lo?Lj=Ve:3===lo?Lj=Il:5===lo?Lj=_i:6===lo&&(Lj=Oh),Lj){var Qj=i.lp(Z.$72l),pe=i.getDataAt(Z.$72l);if(pe&&pe instanceof J){var zl,Vc,Ue;if(Z.$73l=pe,1===lo)if(pe instanceof L.Grid)zl=Z.$75l=On(pe,Qj);else if(pe instanceof L.Shape){Ue=Z.$74l=xr(pe,Qj);var Bq=pe.getPoints();if(Ue){var Dr=Ue.attachIndex,Vq=Qc(pe,i.getDataUI(pe),Dr)+1,Th=Vq+1>=Bq.size()?0:Vq+1,Yi=Bq.get(Vq),Mj=Bq.get(Th),zm=pe.p(),eb=pe.getRotation();Yi=qf(zm,Yi.x-zm.x,Yi.y-zm.y,eb),Mj=qf(zm,Mj.x-zm.x,Mj.y-zm.y,eb),V.beginPath(),V.strokeStyle=W,V.lineWidth=g,V.moveTo(Yi.x*a,Yi.y*a),V.lineTo(Mj.x*a,Mj.y*a),V.stroke()}}zl?Vc=zl.rect:(Vc=m.clone(i.getDataUIBounds(pe)),m.grow(Vc,2)),V.beginPath(),V.rect(Vc.x*a,Vc.y*a,Vc.width*a,Vc.height*a),V.strokeStyle=1===lo||4===lo||6===lo?b:o,V.lineWidth=2,V.setLineDash&&V.setLineDash([8,8]),V.stroke()}else delete Z.$73l;Qj.x=Qj.x*a,Qj.y=Qj.y*a;var kf=Ok(Lj.x,Lj.y,Qj.x,Qj.y),Qn=qf(Lj,Qj.x-Lj.x,Qj.y-Lj.y,-kf),Af=Qn.x-Lj.x;V.translate(Lj.x,Lj.y),V.rotate(kf),G.width=Af,G.height=40;var Jk=o;(1===lo||4===lo||6===lo)&&(Jk=b),G.comps[0].gradientColor=Jk,m.drawImage(V,G,0,-20,Af,40)}}}if(u.each(function(B){var L=i.getDataUI(B);if(L){var b,U,Q=L._55O,I=L._78o;if(Q&&Q._43O&&B instanceof R?(b=Q.$15l,U=B.getSegments(),U&&U.size()||(U=fh(b)),B.isClosePath()&&U.indexOf(5)<0&&(U=new D(U._as),U.add(5))):Q&&I&&Q._43O&&(b=B.s("edge.points"),U=B.s("edge.segments"),b=xm(L,b),U&&U.size()||(U=fh(b)),b&&(b=b._as)),b&&U){var O=0,e=U.size(),P=Z._hoverSegmentIndex;b=b.slice(0);for(var o=0;o<b.length;o++)b[o]=wo(b[o],a);V.beginPath(),V.strokeStyle=$,V.lineWidth=1,O=0;for(var o=0;e>o;o++){var z=U.get(o);if(1===z||2===z)O++;else if(3===z){var p=b[O-1],v=b[O],F=b[O+1];V.moveTo(p.x,p.y),V.lineTo(v.x,v.y),V.lineTo(F.x,F.y),O+=2}else if(4===z){var p=b[O-1],N=b[O],l=b[O+1],F=b[O+2];V.moveTo(p.x,p.y),V.lineTo(N.x,N.y),V.moveTo(l.x,l.y),V.lineTo(F.x,F.y),O+=3}}if(V.stroke(),x===B||c===B&&"points"===c.s("edge.type")){V.beginPath(),O=0,V.strokeStyle=W,V.lineWidth=g;for(var o=0;e>o;o++){var z=U.get(o);if(1===z||2===z){if(P===o){var p=b[O-1],F=b[O];V.moveTo(p.x,p.y),V.lineTo(F.x,F.y);break}O++}else if(3===z){if(P===o){var p=b[O-1],v=b[O],F=b[O+1];V.moveTo(p.x,p.y),V.quadraticCurveTo(v.x,v.y,F.x,F.y);break}O+=2}else if(4===z){if(P===o){var p=b[O-1],N=b[O],l=b[O+1],F=b[O+2];V.moveTo(p.x,p.y),V.bezierCurveTo(N.x,N.y,l.x,l.y,F.x,F.y);break}O+=3}else if(5===z&&P===o){var p=b[O-1],F=b[0];V.moveTo(p.x,p.y),V.lineTo(F.x,F.y);break}}V.stroke()}V.beginPath(),O=0,V.strokeStyle=T,V.lineWidth=1,V.fillStyle=n;for(var o=0;e>o;o++){var z=U.get(o);if(1===z||2===z){var F=b[O];V.moveTo(F.x+h,F.y),V.arc(F.x,F.y,h,0,C,!0),O++}else if(3===z){var F=b[O+1];V.moveTo(F.x+h,F.y),V.arc(F.x,F.y,h,0,C,!0),O+=2}else if(4===z){var F=b[O+2];V.moveTo(F.x+h,F.y),V.arc(F.x,F.y,h,0,C,!0),O+=3}}V.fill(),V.stroke(),V.beginPath(),O=0,V.strokeStyle=Y,V.lineWidth=1,V.fillStyle=r;for(var o=0;e>o;o++){var z=U.get(o);if(1===z||2===z)O++;else if(3===z){var v=b[O];V.moveTo(v.x+h,v.y),V.arc(v.x,v.y,h,0,C,!0),O+=2}else if(4===z){var N=b[O],l=b[O+1];V.moveTo(N.x+h,N.y),V.arc(N.x,N.y,h,0,C,!0),V.moveTo(l.x+h,l.y),V.arc(l.x,l.y,h,0,C,!0),O+=3}}if(V.fill(),V.stroke(),V.beginPath(),O=0,V.strokeStyle=E,V.lineWidth=2,(x===B||c===B)&&Z.$9l!=q){var F=b[Z.$9l];V.moveTo(F.x+h,F.y),V.arc(F.x,F.y,h,0,C,!0),V.stroke()}}}}),Z.$87l&&i.sm().contains(Z.$87l)){var th,Lc=Z.$87l,Xg=Z.$88l,pl=i.getEditHelperSize(),lq=pl/2;if(i.isHelperEditable(Lc,"pointElevation"))if(Lc instanceof R){var _e=Lc.getPosition();th=m.clone(Lc.getPoints().get(Xg)),th=qf({x:_e.x,y:_e.y},th.x-_e.x,th.y-_e.y,Lc.getRotation()),th.x*=a,th.y*=a,V.translate(th.x,th.y),m.drawImage(V,m.getImage("xeditinteractor_elevationIcon"),lq,-lq,pl,pl),V.translate(-th.x,-th.y),Z._pointElevationHelperPoint={x:th.x+pl,y:th.y}}else if(Lc instanceof _){var td=xm(i.getDataUI(Lc),Lc.s("edge.points")),th=m.clone(td.get(Xg));th.x*=a,th.y*=a,V.translate(th.x,th.y),m.drawImage(V,m.getImage("xeditinteractor_elevationIcon"),lq,-lq,pl,pl),V.translate(-th.x,-th.y),Z._pointElevationHelperPoint={x:th.x+pl,y:th.y}}}V.restore(),Z.$5l=0}},$89l:function(A,p,l,o){A.save();var W=this,g=W.gv,U=g.getEditHelperSize(),t=U/2;A.beginPath(),A.translate(l.x,l.y),A.rotate(p),m.drawImage(A,o,-t,-t,U,U),A.restore()},$85l:function(w,K,L){var p=this;p.$90l=L,p.$89l(w,K,L,m.getImage("xeditinteractor_elevationIcon"))},$86l:function(s,F,J){var A=this;A.$91l=J,A.$89l(s,F,J,m.getImage("xeditinteractor_tallIcon"))},$77l:function(F,S,f){var h=this;h.$68l=f,h.$89l(F,S,f,m.getImage("xeditinteractor_hostIcon"))},$80l:function(i,B,V){var T=this;T.$70l=V,T.$89l(i,B,V,m.getImage("xeditinteractor_edgeIcon"))},$81l:function(P,l,W){var o=this;o.$71l=W,o.$89l(P,l,W,m.getImage("xeditinteractor_removeIcon"))},$76l:function(Y,u,i){var f=this;f.$69l=i,f.$89l(Y,u,i,m.getImage("xeditinteractor_parentIcon"))},$84l:function(k,w,o,J,D){var r,i=this,z=i.gv,E=z.getZoom(),d=z.getEditHelperSize(),b=d/2;o.x*=E,o.y*=E,D&&(J?o.x-=b+5:o.x+=b+5),o.y-=d-2,J?(i.$82l=o,r=m.getImage("xeditinteractor_sourceIcon")):(i.$83l=o,r=m.getImage("xeditinteractor_targetIcon")),k.beginPath(),k.translate(o.x,o.y),m.drawImage(k,r,-b,-b,d,d),k.translate(-o.x,-o.y)},$44l:function(C,Z,U){C.save();var A=this.gv.getZoom(),z=M(a(Z.width,2)+a(Z.height,2))/2*A+10,P=z,G=P+8,g=P+18,F=U,H=Z.x+Z.width/2,t=Z.y+Z.height/2;C.translate(H*A,t*A),C.beginPath(),C.strokeStyle="rgb(150, 150, 150)";for(var J=0,V=0,u=0,X=0,v=0,x=0;360>x;x++)J=x*Y/180,0===x%5&&(V=c(J)*P,u=r(J)*P,X=c(J)*G,v=r(J)*G,C.moveTo(V,u),C.lineTo(X,v)),0===x%45&&(V=c(J)*P,u=r(J)*P,X=c(J)*g,v=r(J)*g,C.moveTo(V,u),C.lineTo(X,v));C.stroke(),C.beginPath(),C.rotate(-s),C.beginPath(),C.fillStyle="rgba(255, 0, 0, 0.1)",C.strokeStyle="rgb(157, 157, 157)",C.moveTo(0,0),C.arc(0,0,g,0,U,!1),C.fill(),C.beginPath(),C.moveTo(0+g,0),C.arc(0,0,g,0,U,!1),C.stroke(),C.rotate(s),C.font="bold 12px Verdana, Arial";var W=20*r(F),E=20*c(F),h=Q(180*F/Y)+"";C.textAlign="center",C.textBaseline="middle",C.beginPath();var _=C.measureText("365.").width;C.fillStyle="white",C.rect(W-_/2,-E-10,_,20),C.fill(),C.beginPath(),C.fillStyle="rgb(79,79,79)",C.fillText(h,W,-E),C.restore()
}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);